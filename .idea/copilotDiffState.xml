<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/EJEMPLOS_INTEGRACION.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/EJEMPLOS_INTEGRACION.md" />
              <option name="updatedContent" value="#  Ejemplos de Integración - Sistema de Progreso&#10;&#10;## 1. Al Completar una Lección&#10;&#10;```kotlin&#10;// En tu ViewModel de Lecciones&#10;class LeccionViewModel(&#10;    private val progresoLeccionDao: ProgresoLeccionDao,&#10;    private val estadisticasUsuarioDao: EstadisticasUsuarioDao,&#10;    private val progresoRepository: ProgresoRepository,&#10;    private val usuarioId: Int&#10;) : ViewModel() {&#10;    &#10;    fun completarLeccion(leccionId: Int, puntuacion: Int) {&#10;        viewModelScope.launch {&#10;            try {&#10;                // 1. Registrar progreso de la lección&#10;                val progreso = ProgresoLeccionEntity(&#10;                    usuarioId = usuarioId,&#10;                    leccionId = leccionId,&#10;                    completada = true,&#10;                    puntuacion = puntuacion,&#10;                    intentos = 1,&#10;                    fechaCompletado = System.currentTimeMillis()&#10;                )&#10;                progresoLeccionDao.insertProgreso(progreso)&#10;                &#10;                // 2. Actualizar estadísticas del usuario&#10;                val estadisticas = estadisticasUsuarioDao.getEstadisticasByUsuario(usuarioId)&#10;                estadisticas?.let {&#10;                    estadisticasUsuarioDao.updateEstadisticas(&#10;                        it.copy(&#10;                            puntosTotal = it.puntosTotal + puntuacion,&#10;                            leccionesCompletadas = it.leccionesCompletadas + 1,&#10;                            ultimaActualizacion = System.currentTimeMillis()&#10;                        )&#10;                    )&#10;                }&#10;                &#10;                // 3. Verificar si se desbloquearon logros&#10;                progresoRepository.verificarLogros(usuarioId)&#10;                &#10;                // 4. Mostrar mensaje de éxito&#10;                _uiState.value = _uiState.value.copy(&#10;                    mensajeExito = &quot;¡Lección completada! +$puntuacion puntos&quot;&#10;                )&#10;            } catch (e: Exception) {&#10;                _uiState.value = _uiState.value.copy(&#10;                    error = &quot;Error al guardar progreso: ${e.message}&quot;&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;```&#10;&#10;## 2. Inicializar Estadísticas de Nuevo Usuario&#10;&#10;```kotlin&#10;// En UserRepository.kt al registrar un usuario&#10;suspend fun registerUser(username: String, email: String, password: String): Result&lt;Long&gt; {&#10;    return try {&#10;        val existingUser = userDao.getUserByEmail(email)&#10;        if (existingUser != null) {&#10;            Result.failure(Exception(&quot;El correo electrónico ya está registrado&quot;))&#10;        } else {&#10;            val user = UserEntity(&#10;                username = username,&#10;                email = email,&#10;                password = password&#10;            )&#10;            val userId = userDao.insertUser(user)&#10;            &#10;            // Inicializar estadísticas del nuevo usuario&#10;            val estadisticas = EstadisticasUsuarioEntity(&#10;                usuarioId = userId.toInt(),&#10;                puntosTotal = 0,&#10;                rachaActual = 0,&#10;                rachaMayor = 0,&#10;                leccionesCompletadas = 0,&#10;                diasActivos = 0&#10;            )&#10;            estadisticasUsuarioDao.insertEstadisticas(estadisticas)&#10;            &#10;            // Inicializar logros del usuario&#10;            val logros = logroDao.getAllLogros()&#10;            logros.forEach { logro -&gt;&#10;                logroUsuarioDao.insertLogroUsuario(&#10;                    LogroUsuarioEntity(&#10;                        usuarioId = userId.toInt(),&#10;                        logroId = logro.id,&#10;                        obtenido = false&#10;                    )&#10;                )&#10;            }&#10;            &#10;            Result.success(userId)&#10;        }&#10;    } catch (e: Exception) {&#10;        Result.failure(e)&#10;    }&#10;}&#10;```&#10;&#10;## 3. Mostrar Logro Desbloqueado&#10;&#10;```kotlin&#10;// Composable para mostrar un dialog de logro&#10;@Composable&#10;fun LogroDesbloqueadoDialog(&#10;    logro: LogroEntity,&#10;    onDismiss: () -&gt; Unit&#10;) {&#10;    AlertDialog(&#10;        onDismissRequest = onDismiss,&#10;        title = {&#10;            Column(&#10;                horizontalAlignment = Alignment.CenterHorizontally,&#10;                modifier = Modifier.fillMaxWidth()&#10;            ) {&#10;                Text(&#10;                    text = logro.emoji,&#10;                    fontSize = 64.sp&#10;                )&#10;                Spacer(modifier = Modifier.height(16.dp))&#10;                Text(&#10;                    text = &quot;¡Logro Desbloqueado!&quot;,&#10;                    fontSize = 24.sp,&#10;                    fontWeight = FontWeight.Bold&#10;                )&#10;            }&#10;        },&#10;        text = {&#10;            Column(&#10;                horizontalAlignment = Alignment.CenterHorizontally,&#10;                modifier = Modifier.fillMaxWidth()&#10;            ) {&#10;                Text(&#10;                    text = logro.nombre,&#10;                    fontSize = 20.sp,&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = MaterialTheme.colorScheme.primary&#10;                )&#10;                Spacer(modifier = Modifier.height(8.dp))&#10;                Text(&#10;                    text = logro.descripcion,&#10;                    fontSize = 16.sp,&#10;                    textAlign = TextAlign.Center&#10;                )&#10;            }&#10;        },&#10;        confirmButton = {&#10;            Button(onClick = onDismiss) {&#10;                Text(&quot;¡Genial!&quot;)&#10;            }&#10;        }&#10;    )&#10;}&#10;&#10;// En el ViewModel&#10;private val _logroDesbloqueado = MutableStateFlow&lt;LogroEntity?&gt;(null)&#10;val logroDesbloqueado: StateFlow&lt;LogroEntity?&gt; = _logroDesbloqueado.asStateFlow()&#10;&#10;suspend fun verificarYMostrarLogros() {&#10;    val logrosAnteriores = logroUsuarioDao.getLogrosObtenidos(usuarioId)&#10;    progresoRepository.verificarLogros(usuarioId)&#10;    val logrosNuevos = logroUsuarioDao.getLogrosObtenidos(usuarioId)&#10;    &#10;    // Encontrar logros recién desbloqueados&#10;    val nuevosIds = logrosNuevos.map { it.logroId } - logrosAnteriores.map { it.logroId }.toSet()&#10;    if (nuevosIds.isNotEmpty()) {&#10;        val logroNuevo = logroDao.getLogroById(nuevosIds.first())&#10;        _logroDesbloqueado.value = logroNuevo&#10;    }&#10;}&#10;&#10;// En el Screen&#10;val logroDesbloqueado by viewModel.logroDesbloqueado.collectAsState()&#10;&#10;logroDesbloqueado?.let { logro -&gt;&#10;    LogroDesbloqueadoDialog(&#10;        logro = logro,&#10;        onDismiss = { viewModel.dismissLogro() }&#10;    )&#10;}&#10;```&#10;&#10;## 4. Widget de Racha en HomeScreen&#10;&#10;```kotlin&#10;@Composable&#10;fun RachaWidget(racha: Int) {&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(16.dp),&#10;        shape = RoundedCornerShape(16.dp),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = if (racha &gt; 0) &#10;                MaterialTheme.colorScheme.primaryContainer &#10;            else &#10;                MaterialTheme.colorScheme.surfaceVariant&#10;        )&#10;    ) {&#10;        Row(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(16.dp),&#10;            horizontalArrangement = Arrangement.SpaceBetween,&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Row(verticalAlignment = Alignment.CenterVertically) {&#10;                Text(&#10;                    text = &quot;&quot;,&#10;                    fontSize = 32.sp&#10;                )&#10;                Spacer(modifier = Modifier.width(12.dp))&#10;                Column {&#10;                    Text(&#10;                        text = &quot;Racha Actual&quot;,&#10;                        fontSize = 14.sp,&#10;                        color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                    )&#10;                    Text(&#10;                        text = &quot;$racha días&quot;,&#10;                        fontSize = 24.sp,&#10;                        fontWeight = FontWeight.Bold,&#10;                        color = MaterialTheme.colorScheme.primary&#10;                    )&#10;                }&#10;            }&#10;            &#10;            if (racha &gt; 0) {&#10;                Text(&#10;                    text = &quot;¡Sigue así!&quot;,&#10;                    fontSize = 12.sp,&#10;                    color = MaterialTheme.colorScheme.primary,&#10;                    fontWeight = FontWeight.Bold&#10;                )&#10;            } else {&#10;                Text(&#10;                    text = &quot;Comienza hoy&quot;,&#10;                    fontSize = 12.sp,&#10;                    color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;// En HomeScreen&#10;@Composable&#10;fun InicioScreen() {&#10;    val context = LocalContext.current&#10;    val database = EcoHandDatabase.getDatabase(context)&#10;    val userSession = UserSession.getInstance(context)&#10;    val usuarioId = userSession.getUserId()&#10;    &#10;    val estadisticas = remember {&#10;        mutableStateOf&lt;EstadisticasUsuarioEntity?&gt;(null)&#10;    }&#10;    &#10;    LaunchedEffect(usuarioId) {&#10;        withContext(Dispatchers.IO) {&#10;            estadisticas.value = database.estadisticasUsuarioDao()&#10;                .getEstadisticasByUsuario(usuarioId)&#10;        }&#10;    }&#10;    &#10;    Column(modifier = Modifier.fillMaxSize()) {&#10;        estadisticas.value?.let { stats -&gt;&#10;            RachaWidget(racha = stats.rachaActual)&#10;        }&#10;        // ... resto del contenido&#10;    }&#10;}&#10;```&#10;&#10;## 5. Indicador de Progreso en PerfilScreen&#10;&#10;```kotlin&#10;@Composable&#10;fun ProgresoResumen(&#10;    puntosTotal: Int,&#10;    leccionesCompletadas: Int,&#10;    totalLecciones: Int&#10;) {&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(16.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(20.dp)&#10;        ) {&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                horizontalArrangement = Arrangement.SpaceBetween&#10;            ) {&#10;                StatItem(&#10;                    emoji = &quot;⭐&quot;,&#10;                    label = &quot;Puntos&quot;,&#10;                    value = puntosTotal.toString()&#10;                )&#10;                StatItem(&#10;                    emoji = &quot;&quot;,&#10;                    label = &quot;Lecciones&quot;,&#10;                    value = &quot;$leccionesCompletadas/$totalLecciones&quot;&#10;                )&#10;            }&#10;            &#10;            Spacer(modifier = Modifier.height(16.dp))&#10;            &#10;            LinearProgressIndicator(&#10;                progress = leccionesCompletadas.toFloat() / totalLecciones.toFloat(),&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .height(8.dp)&#10;                    .clip(RoundedCornerShape(4.dp))&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun StatItem(emoji: String, label: String, value: String) {&#10;    Column(horizontalAlignment = Alignment.CenterHorizontally) {&#10;        Text(text = emoji, fontSize = 32.sp)&#10;        Text(&#10;            text = value,&#10;            fontSize = 20.sp,&#10;            fontWeight = FontWeight.Bold,&#10;            color = MaterialTheme.colorScheme.primary&#10;        )&#10;        Text(&#10;            text = label,&#10;            fontSize = 12.sp,&#10;            color = MaterialTheme.colorScheme.onSurfaceVariant&#10;        )&#10;    }&#10;}&#10;```&#10;&#10;## 6. Notificación de Recordatorio de Racha&#10;&#10;```kotlin&#10;// En un WorkManager o servicio&#10;class RachaReminderWorker(&#10;    context: Context,&#10;    params: WorkerParameters&#10;) : CoroutineWorker(context, params) {&#10;    &#10;    override suspend fun doWork(): Result {&#10;        val userSession = UserSession.getInstance(applicationContext)&#10;        val userId = userSession.getUserId()&#10;        &#10;        if (userId == -1) return Result.success()&#10;        &#10;        val database = EcoHandDatabase.getDatabase(applicationContext)&#10;        val actividadDao = database.actividadDiariaDao()&#10;        &#10;        // Verificar si el usuario ya inició sesión hoy&#10;        val hoy = Calendar.getInstance().apply {&#10;            set(Calendar.HOUR_OF_DAY, 0)&#10;            set(Calendar.MINUTE, 0)&#10;            set(Calendar.SECOND, 0)&#10;            set(Calendar.MILLISECOND, 0)&#10;        }.timeInMillis&#10;        &#10;        val actividadHoy = actividadDao.getActividadPorFecha(userId, hoy)&#10;        &#10;        if (actividadHoy == null) {&#10;            // Mostrar notificación&#10;            showReminderNotification()&#10;        }&#10;        &#10;        return Result.success()&#10;    }&#10;    &#10;    private fun showReminderNotification() {&#10;        val notification = NotificationCompat.Builder(applicationContext, &quot;racha_channel&quot;)&#10;            .setSmallIcon(R.drawable.ic_fire)&#10;            .setContentTitle(&quot;¡No pierdas tu racha! &quot;)&#10;            .setContentText(&quot;Practica hoy para mantener tu racha activa&quot;)&#10;            .setPriority(NotificationCompat.PRIORITY_DEFAULT)&#10;            .build()&#10;        &#10;        with(NotificationManagerCompat.from(applicationContext)) {&#10;            notify(1, notification)&#10;        }&#10;    }&#10;}&#10;```&#10;&#10;## 7. Sistema de Niveles (Opcional)&#10;&#10;```kotlin&#10;// Agregar campo a EstadisticasUsuarioEntity&#10;val nivel: Int = 1&#10;&#10;// Función para calcular nivel&#10;fun calcularNivel(puntosTotal: Int): Int {&#10;    return when {&#10;        puntosTotal &lt; 100 -&gt; 1&#10;        puntosTotal &lt; 300 -&gt; 2&#10;        puntosTotal &lt; 600 -&gt; 3&#10;        puntosTotal &lt; 1000 -&gt; 4&#10;        puntosTotal &lt; 1500 -&gt; 5&#10;        else -&gt; 6&#10;    }&#10;}&#10;&#10;// Componente de Nivel&#10;@Composable&#10;fun NivelBadge(nivel: Int) {&#10;    Box(&#10;        modifier = Modifier&#10;            .size(60.dp)&#10;            .background(&#10;                brush = Brush.radialGradient(&#10;                    colors = listOf(&#10;                        MaterialTheme.colorScheme.primary,&#10;                        MaterialTheme.colorScheme.primaryContainer&#10;                    )&#10;                ),&#10;                shape = CircleShape&#10;            ),&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        Text(&#10;            text = &quot;$nivel&quot;,&#10;            fontSize = 24.sp,&#10;            fontWeight = FontWeight.Bold,&#10;            color = Color.White&#10;        )&#10;    }&#10;}&#10;```&#10;&#10;---&#10;&#10;**¡Usa estos ejemplos para integrar completamente el sistema de progreso en tu aplicación!** &#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/GUIA_USO_PROGRESO.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/GUIA_USO_PROGRESO.md" />
              <option name="updatedContent" value="#  Guía de Uso - Sección de Progreso EcoHand&#10;&#10;## ✅ Implementación Completada&#10;&#10;Se ha implementado exitosamente la sección de **Progreso** en la aplicación EcoHand con todas las funcionalidades solicitadas.&#10;&#10;##  Qué Se Implementó&#10;&#10;### 1. **Base de Datos** &#10;- ✅ 6 nuevas tablas en SQLite&#10;- ✅ Datos iniciales (5 lecciones y 8 logros)&#10;- ✅ Relaciones entre tablas con Foreign Keys&#10;- ✅ Actualización automática de estadísticas&#10;&#10;### 2. **Interfaz de Usuario**&#10;- ✅ Card de Progreso General con barra de progreso&#10;- ✅ Grid 2x2 de estadísticas (Puntos, Racha, Lecciones, Días Activos)&#10;- ✅ Card de Actividad Semanal (L-D)&#10;- ✅ Card de Logros con estado visual&#10;&#10;### 3. **Funcionalidades Automáticas**&#10;- ✅ Registro automático de actividad diaria&#10;- ✅ Cálculo de rachas consecutivas&#10;- ✅ Verificación y desbloqueo de logros&#10;- ✅ Persistencia de sesión de usuario&#10;&#10;##  Cómo Usar&#10;&#10;### Al Iniciar Sesión&#10;1. El usuario inicia sesión o se registra&#10;2. La sesión se guarda automáticamente en SharedPreferences&#10;3. Al navegar a &quot;Progreso&quot;, se registra la actividad del día&#10;&#10;### Visualización del Progreso&#10;- **Progreso General**: Muestra % de lecciones completadas&#10;- **Puntos Total**: Suma de puntuaciones obtenidas&#10;- **Racha**: Días consecutivos activos&#10;- **Lecciones**: Cantidad completada&#10;- **Días Activos**: Total de días de uso&#10;- **Actividad Semanal**: Vista del lunes al domingo actual&#10;- **Logros**: Lista con estado obtenido/bloqueado&#10;&#10;##  Próximos Pasos para Desarrollo&#10;&#10;Para que el sistema de progreso funcione completamente, necesitas:&#10;&#10;### 1. **Implementar Sistema de Lecciones**&#10;```kotlin&#10;// En LeccionesScreen.kt o donde implementes las lecciones&#10;viewModelScope.launch {&#10;    // Al completar una lección&#10;    val progreso = ProgresoLeccionEntity(&#10;        usuarioId = usuarioId,&#10;        leccionId = leccionId,&#10;        completada = true,&#10;        puntuacion = 85, // 0-100&#10;        intentos = 1,&#10;        fechaCompletado = System.currentTimeMillis()&#10;    )&#10;    progresoLeccionDao.insertProgreso(progreso)&#10;    &#10;    // Actualizar estadísticas&#10;    val estadisticas = estadisticasUsuarioDao.getEstadisticasByUsuario(usuarioId)&#10;    estadisticas?.let {&#10;        estadisticasUsuarioDao.updateEstadisticas(&#10;            it.copy(&#10;                puntosTotal = it.puntosTotal + 85,&#10;                leccionesCompletadas = it.leccionesCompletadas + 1&#10;            )&#10;        )&#10;    }&#10;}&#10;```&#10;&#10;### 2. **Llamar a verificarLogros()**&#10;Después de completar acciones importantes:&#10;```kotlin&#10;progresoRepository.verificarLogros(usuarioId)&#10;```&#10;&#10;### 3. **Mostrar Notificaciones de Logros**&#10;```kotlin&#10;// Cuando se desbloquea un logro&#10;if (logroDesbloqueado) {&#10;    Toast.makeText(context, &quot;¡Logro desbloqueado: ${logro.nombre}!&quot;, Toast.LENGTH_LONG).show()&#10;    // O usar un Dialog personalizado&#10;}&#10;```&#10;&#10;##  Datos de Prueba&#10;&#10;### Para Probar el Sistema&#10;&#10;1. **Crear Usuario de Prueba**:&#10;   - Email: test@test.com&#10;   - Contraseña: test123&#10;&#10;2. **Agregar Progreso Manualmente** (opcional para pruebas):&#10;```sql&#10;-- Completar una lección&#10;INSERT INTO progreso_lecciones (usuarioId, leccionId, completada, puntuacion, intentos, fechaCompletado)&#10;VALUES (1, 1, 1, 100, 1, strftime('%s', 'now') * 1000);&#10;&#10;-- Actualizar estadísticas&#10;UPDATE estadisticas_usuario &#10;SET puntosTotal = 100, leccionesCompletadas = 1 &#10;WHERE usuarioId = 1;&#10;```&#10;&#10;3. **Agregar Actividades para Racha**:&#10;```sql&#10;-- Agregar actividad de días anteriores&#10;INSERT INTO actividad_diaria (usuarioId, fecha, activo)&#10;VALUES &#10;  (1, strftime('%s', 'now', '-1 day') * 1000, 1),&#10;  (1, strftime('%s', 'now', '-2 day') * 1000, 1),&#10;  (1, strftime('%s', 'now', '-3 day') * 1000, 1);&#10;```&#10;&#10;##  Solución de Problemas&#10;&#10;### Si el progreso no se muestra:&#10;1. Verificar que el usuario esté logueado correctamente&#10;2. Revisar que `UserSession.getUserId()` retorne un ID válido&#10;3. Verificar logs en Logcat para errores&#10;&#10;### Si los logros no se desbloquean:&#10;1. Asegurarse de que las estadísticas se actualicen al completar lecciones&#10;2. Llamar manualmente a `progresoRepository.verificarLogros(usuarioId)`&#10;&#10;### Si hay errores de compilación:&#10;```bash&#10;# Limpiar y reconstruir&#10;./gradlew clean&#10;./gradlew build&#10;&#10;# O en Android Studio:&#10;Build &gt; Clean Project&#10;Build &gt; Rebuild Project&#10;```&#10;&#10;##  Archivos Importantes&#10;&#10;### Para Modificar Lecciones:&#10;- `EcoHandDatabase.kt` (líneas 65-110) - Datos iniciales de lecciones&#10;&#10;### Para Modificar Logros:&#10;- `EcoHandDatabase.kt` (líneas 112-150) - Datos iniciales de logros&#10;- `ProgresoRepository.kt` (líneas 145-180) - Lógica de verificación&#10;&#10;### Para Modificar UI:&#10;- `ProgresoScreen.kt` - Toda la interfaz visual&#10;- `ProgresoViewModel.kt` - Lógica y estado&#10;&#10;##  Personalización&#10;&#10;### Cambiar Colores:&#10;Editar `Color.kt`:&#10;```kotlin&#10;val NavyBlue = Color(0xFF001F3F) // Tu color preferido&#10;```&#10;&#10;### Agregar Más Logros:&#10;1. Agregar en `EcoHandDatabase.kt` en el método `populateDatabase()`&#10;2. Agregar lógica en `ProgresoRepository.kt` en `verificarLogros()`&#10;&#10;### Cambiar Emojis:&#10;Editar directamente en la UI o en los datos iniciales.&#10;&#10;## ✨ Características Destacadas&#10;&#10;- ✅ **Arquitectura MVVM** - Separación clara de responsabilidades&#10;- ✅ **Room Database** - Persistencia robusta&#10;- ✅ **Material Design 3** - UI moderna&#10;- ✅ **Jetpack Compose** - UI declarativa y reactiva&#10;- ✅ **Kotlin Coroutines** - Operaciones asíncronas eficientes&#10;- ✅ **StateFlow** - Gestión de estado reactiva&#10;&#10;##  Soporte&#10;&#10;Si encuentras problemas:&#10;1. Revisa los logs en Logcat&#10;2. Verifica que la versión de la base de datos sea 2&#10;3. Asegúrate de que todos los archivos estén en su lugar&#10;4. Limpia y reconstruye el proyecto&#10;&#10;---&#10;&#10;**¡Éxito con tu aplicación EcoHand! **&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/PROGRESO_IMPLEMENTATION.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/PROGRESO_IMPLEMENTATION.md" />
              <option name="updatedContent" value="# Implementación de la Sección de Progreso - EcoHand&#10;&#10;## Resumen de la Implementación&#10;&#10;Se ha implementado completamente la sección de **Progreso** para la aplicación EcoHand, incluyendo todas las funcionalidades solicitadas y manteniendo la arquitectura del proyecto.&#10;&#10;## ️ Base de Datos - Nuevas Tablas Creadas&#10;&#10;### 1. **lecciones**&#10;Almacena las lecciones disponibles en la aplicación.&#10;- Campos: id, titulo, descripcion, nivel, orden, icono, bloqueada, createdAt&#10;- 5 lecciones predeterminadas: Saludos Básicos, Alfabeto, Números, Cortesía, Familia&#10;&#10;### 2. **progreso_lecciones**&#10;Rastrea el progreso del usuario en cada lección.&#10;- Campos: id, usuarioId, leccionId, completada, puntuacion, intentos, fechaInicio, fechaCompletado&#10;- Relación con users y lecciones (Foreign Keys)&#10;&#10;### 3. **actividad_diaria**&#10;Registra los días en que el usuario inició sesión.&#10;- Campos: id, usuarioId, fecha, activo&#10;- Permite calcular rachas y días activos&#10;&#10;### 4. **estadisticas_usuario**&#10;Almacena estadísticas generales del usuario.&#10;- Campos: id, usuarioId, puntosTotal, rachaActual, rachaMayor, leccionesCompletadas, diasActivos&#10;- Se actualiza automáticamente con el progreso&#10;&#10;### 5. **logros**&#10;Define los logros disponibles en la aplicación.&#10;- 8 logros predeterminados: Primer Paso, En Racha, Experto en Saludos, Cortés, Maestro del Alfabeto, Contador Experto, Estudiante Dedicado, Maestro EcoHand&#10;&#10;### 6. **logros_usuario**&#10;Rastrea qué logros ha obtenido cada usuario.&#10;- Campos: id, usuarioId, logroId, obtenido, fechaObtenido&#10;&#10;##  Estructura de Archivos Creados/Modificados&#10;&#10;### Entidades (data/local/entity/)&#10;- ✅ `LeccionEntity.kt` - Nueva&#10;- ✅ `ProgresoLeccionEntity.kt` - Nueva&#10;- ✅ `ActividadDiariaEntity.kt` - Nueva&#10;- ✅ `LogroEntity.kt` - Nueva&#10;- ✅ `LogroUsuarioEntity.kt` - Nueva&#10;- ✅ `EstadisticasUsuarioEntity.kt` - Nueva&#10;&#10;### DAOs (data/local/dao/)&#10;- ✅ `LeccionDao.kt` - Nuevo&#10;- ✅ `ProgresoLeccionDao.kt` - Nuevo&#10;- ✅ `ActividadDiariaDao.kt` - Nuevo&#10;- ✅ `LogroDao.kt` - Nuevo&#10;- ✅ `LogroUsuarioDao.kt` - Nuevo&#10;- ✅ `EstadisticasUsuarioDao.kt` - Nuevo&#10;&#10;### Repositorios (data/repository/)&#10;- ✅ `ProgresoRepository.kt` - Nuevo (gestiona toda la lógica de progreso)&#10;&#10;### Sesión (data/session/)&#10;- ✅ `UserSession.kt` - Nuevo (maneja la sesión del usuario con SharedPreferences)&#10;&#10;### Base de Datos (data/local/database/)&#10;- ✅ `EcoHandDatabase.kt` - Actualizada (versión 2, incluye todas las nuevas entidades y datos iniciales)&#10;&#10;### Presentación (presentation/progreso/)&#10;- ✅ `ProgresoViewModel.kt` - Nuevo&#10;- ✅ `ProgresoScreen.kt` - Actualizada completamente&#10;&#10;### Otros&#10;- ✅ `MainScreen.kt` - Actualizada para inyectar ProgresoViewModel&#10;- ✅ `LoginViewModel.kt` - Actualizada para guardar sesión&#10;- ✅ `AppNavigation.kt` - Actualizada para incluir UserSession&#10;&#10;##  Interfaz de Usuario Implementada&#10;&#10;### 1. **Progreso General (Card)**&#10;- Barra de progreso visual&#10;- Texto: &quot;X de Y lecciones completadas (Z%)&quot;&#10;- Diseño: Card con bordes redondeados&#10;&#10;### 2. **Estadísticas Grid (2x2)**&#10;Cuatro tarjetas mostrando:&#10;- ⭐ **Puntos Total**: Suma de puntuaciones&#10;-  **Racha**: Días consecutivos activos&#10;-  **Lecciones**: Número de lecciones completadas&#10;-  **Días Activos**: Total de días que el usuario ha usado la app&#10;&#10;### 3. **Actividad Semanal (Card)**&#10;- Muestra 7 días de la semana (L, M, X, J, V, S, D)&#10;- Círculos verdes con ✓ para días activos&#10;- Círculos grises para días inactivos&#10;- Automáticamente calcula la semana actual&#10;&#10;### 4. **Logros (Card)**&#10;- Lista de todos los logros disponibles&#10;- Muestra emoji representativo para cada logro&#10;- Indica visualmente cuáles están obtenidos (con ✓ verde)&#10;- Logros bloqueados aparecen en gris&#10;&#10;##  Funcionalidades Automáticas&#10;&#10;### Registro de Actividad&#10;- Al cargar ProgresoScreen, se registra automáticamente la actividad del día&#10;- Actualiza días activos y rachas&#10;&#10;### Cálculo de Rachas&#10;- Detecta automáticamente días consecutivos&#10;- Actualiza racha actual y mayor racha&#10;&#10;### Verificación de Logros&#10;- Se ejecuta automáticamente al cargar el progreso&#10;- Desbloquea logros según criterios:&#10;  - **Primer Paso**: 1 lección completada&#10;  - **En Racha**: 7 días consecutivos&#10;  - **Experto en Saludos**: Completar lección 1&#10;  - **Cortés**: Completar lección 4&#10;  - **Maestro del Alfabeto**: Completar lección 2&#10;  - **Contador Experto**: Completar lección 3&#10;  - **Estudiante Dedicado**: 3 lecciones completadas&#10;  - **Maestro EcoHand**: Todas las lecciones completadas&#10;&#10;##  Diseño y Estilo&#10;&#10;- ✅ Mantiene la paleta de colores actual (azul marino)&#10;- ✅ Usa MaterialTheme para consistencia&#10;- ✅ Cards con elevación de 4dp y bordes redondeados de 16dp&#10;- ✅ Espaciado consistente de 16dp entre elementos&#10;- ✅ Emojis para representación visual&#10;- ✅ Diseño responsive con LazyColumn&#10;- ✅ Estados de carga con CircularProgressIndicator&#10;&#10;##  Arquitectura&#10;&#10;- **MVVM** (Model-View-ViewModel)&#10;- **Room Database** para persistencia&#10;- **Kotlin Coroutines** para operaciones asíncronas&#10;- **StateFlow** para manejo de estado reactivo&#10;- **Jetpack Compose** para UI&#10;- **SharedPreferences** para sesión de usuario&#10;&#10;##  Datos Iniciales&#10;&#10;### Lecciones (5)&#10;1. Saludos Básicos  - BASICO&#10;2. Alfabeto  - BASICO&#10;3. Números  - BASICO&#10;4. Cortesía  - INTERMEDIO&#10;5. Familia ‍‍‍ - INTERMEDIO&#10;&#10;### Logros (8)&#10;1. Primer Paso &#10;2. En Racha &#10;3. Experto en Saludos &#10;4. Cortés &#10;5. Maestro del Alfabeto &#10;6. Contador Experto &#10;7. Estudiante Dedicado &#10;8. Maestro EcoHand &#10;&#10;##  Próximos Pasos Sugeridos&#10;&#10;Para completar la funcionalidad:&#10;&#10;1. **Implementar lecciones reales** que actualicen el progreso&#10;2. **Sistema de puntos** al completar lecciones&#10;3. **Animaciones** al desbloquear logros&#10;4. **Notificaciones** para mantener rachas&#10;5. **Gráficos de progreso** histórico&#10;6. **Compartir logros** en redes sociales&#10;&#10;## ✅ Estado Actual&#10;&#10;La implementación está **completa y funcional**. Todos los componentes están conectados y la base de datos se inicializa con datos predeterminados al crear la aplicación por primera vez.&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/dao/ActividadDiariaDao.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/dao/ActividadDiariaDao.kt" />
              <option name="updatedContent" value="package com.example.ecohand.data.local.dao&#10;&#10;import androidx.room.Dao&#10;import androidx.room.Insert&#10;import androidx.room.OnConflictStrategy&#10;import androidx.room.Query&#10;import com.example.ecohand.data.local.entity.ActividadDiariaEntity&#10;&#10;@Dao&#10;interface ActividadDiariaDao {&#10;    &#10;    @Insert(onConflict = OnConflictStrategy.REPLACE)&#10;    suspend fun insertActividad(actividad: ActividadDiariaEntity): Long&#10;    &#10;    @Query(&quot;SELECT * FROM actividad_diaria WHERE usuarioId = :usuarioId ORDER BY fecha DESC&quot;)&#10;    suspend fun getActividadByUsuario(usuarioId: Int): List&lt;ActividadDiariaEntity&gt;&#10;    &#10;    @Query(&quot;SELECT * FROM actividad_diaria WHERE usuarioId = :usuarioId AND fecha &gt;= :fechaInicio AND fecha &lt;= :fechaFin ORDER BY fecha ASC&quot;)&#10;    suspend fun getActividadPorRango(usuarioId: Int, fechaInicio: Long, fechaFin: Long): List&lt;ActividadDiariaEntity&gt;&#10;    &#10;    @Query(&quot;SELECT COUNT(DISTINCT fecha) FROM actividad_diaria WHERE usuarioId = :usuarioId AND activo = 1&quot;)&#10;    suspend fun getDiasActivosCount(usuarioId: Int): Int&#10;    &#10;    @Query(&quot;SELECT * FROM actividad_diaria WHERE usuarioId = :usuarioId AND fecha = :fecha LIMIT 1&quot;)&#10;    suspend fun getActividadPorFecha(usuarioId: Int, fecha: Long): ActividadDiariaEntity?&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/dao/EstadisticasUsuarioDao.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/dao/EstadisticasUsuarioDao.kt" />
              <option name="updatedContent" value="package com.example.ecohand.data.local.dao&#10;&#10;import androidx.room.Dao&#10;import androidx.room.Insert&#10;import androidx.room.OnConflictStrategy&#10;import androidx.room.Query&#10;import androidx.room.Update&#10;import com.example.ecohand.data.local.entity.EstadisticasUsuarioEntity&#10;&#10;@Dao&#10;interface EstadisticasUsuarioDao {&#10;    &#10;    @Insert(onConflict = OnConflictStrategy.REPLACE)&#10;    suspend fun insertEstadisticas(estadisticas: EstadisticasUsuarioEntity): Long&#10;    &#10;    @Update&#10;    suspend fun updateEstadisticas(estadisticas: EstadisticasUsuarioEntity)&#10;    &#10;    @Query(&quot;SELECT * FROM estadisticas_usuario WHERE usuarioId = :usuarioId LIMIT 1&quot;)&#10;    suspend fun getEstadisticasByUsuario(usuarioId: Int): EstadisticasUsuarioEntity?&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/dao/LeccionDao.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/dao/LeccionDao.kt" />
              <option name="updatedContent" value="package com.example.ecohand.data.local.dao&#10;&#10;import androidx.room.Dao&#10;import androidx.room.Insert&#10;import androidx.room.OnConflictStrategy&#10;import androidx.room.Query&#10;import androidx.room.Update&#10;import com.example.ecohand.data.local.entity.LeccionEntity&#10;&#10;@Dao&#10;interface LeccionDao {&#10;    &#10;    @Insert(onConflict = OnConflictStrategy.REPLACE)&#10;    suspend fun insertLeccion(leccion: LeccionEntity): Long&#10;    &#10;    @Insert(onConflict = OnConflictStrategy.REPLACE)&#10;    suspend fun insertAll(lecciones: List&lt;LeccionEntity&gt;)&#10;    &#10;    @Update&#10;    suspend fun updateLeccion(leccion: LeccionEntity)&#10;    &#10;    @Query(&quot;SELECT * FROM lecciones ORDER BY orden ASC&quot;)&#10;    suspend fun getAllLecciones(): List&lt;LeccionEntity&gt;&#10;    &#10;    @Query(&quot;SELECT * FROM lecciones WHERE id = :leccionId LIMIT 1&quot;)&#10;    suspend fun getLeccionById(leccionId: Int): LeccionEntity?&#10;    &#10;    @Query(&quot;SELECT COUNT(*) FROM lecciones&quot;)&#10;    suspend fun getTotalLecciones(): Int&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/dao/LogroDao.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/dao/LogroDao.kt" />
              <option name="updatedContent" value="package com.example.ecohand.data.local.dao&#10;&#10;import androidx.room.Dao&#10;import androidx.room.Insert&#10;import androidx.room.OnConflictStrategy&#10;import androidx.room.Query&#10;import com.example.ecohand.data.local.entity.LogroEntity&#10;&#10;@Dao&#10;interface LogroDao {&#10;    &#10;    @Insert(onConflict = OnConflictStrategy.REPLACE)&#10;    suspend fun insertLogro(logro: LogroEntity): Long&#10;    &#10;    @Insert(onConflict = OnConflictStrategy.REPLACE)&#10;    suspend fun insertAll(logros: List&lt;LogroEntity&gt;)&#10;    &#10;    @Query(&quot;SELECT * FROM logros ORDER BY id ASC&quot;)&#10;    suspend fun getAllLogros(): List&lt;LogroEntity&gt;&#10;    &#10;    @Query(&quot;SELECT * FROM logros WHERE id = :logroId LIMIT 1&quot;)&#10;    suspend fun getLogroById(logroId: Int): LogroEntity?&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/dao/LogroUsuarioDao.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/dao/LogroUsuarioDao.kt" />
              <option name="updatedContent" value="package com.example.ecohand.data.local.dao&#10;&#10;import androidx.room.Dao&#10;import androidx.room.Insert&#10;import androidx.room.OnConflictStrategy&#10;import androidx.room.Query&#10;import androidx.room.Update&#10;import com.example.ecohand.data.local.entity.LogroUsuarioEntity&#10;&#10;@Dao&#10;interface LogroUsuarioDao {&#10;    &#10;    @Insert(onConflict = OnConflictStrategy.REPLACE)&#10;    suspend fun insertLogroUsuario(logroUsuario: LogroUsuarioEntity): Long&#10;    &#10;    @Update&#10;    suspend fun updateLogroUsuario(logroUsuario: LogroUsuarioEntity)&#10;    &#10;    @Query(&quot;SELECT * FROM logros_usuario WHERE usuarioId = :usuarioId&quot;)&#10;    suspend fun getLogrosByUsuario(usuarioId: Int): List&lt;LogroUsuarioEntity&gt;&#10;    &#10;    @Query(&quot;SELECT * FROM logros_usuario WHERE usuarioId = :usuarioId AND obtenido = 1&quot;)&#10;    suspend fun getLogrosObtenidos(usuarioId: Int): List&lt;LogroUsuarioEntity&gt;&#10;    &#10;    @Query(&quot;SELECT * FROM logros_usuario WHERE usuarioId = :usuarioId AND logroId = :logroId LIMIT 1&quot;)&#10;    suspend fun getLogroUsuario(usuarioId: Int, logroId: Int): LogroUsuarioEntity?&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/dao/ProgresoLeccionDao.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/dao/ProgresoLeccionDao.kt" />
              <option name="updatedContent" value="package com.example.ecohand.data.local.dao&#10;&#10;import androidx.room.Dao&#10;import androidx.room.Insert&#10;import androidx.room.OnConflictStrategy&#10;import androidx.room.Query&#10;import androidx.room.Update&#10;import com.example.ecohand.data.local.entity.ProgresoLeccionEntity&#10;&#10;@Dao&#10;interface ProgresoLeccionDao {&#10;    &#10;    @Insert(onConflict = OnConflictStrategy.REPLACE)&#10;    suspend fun insertProgreso(progreso: ProgresoLeccionEntity): Long&#10;    &#10;    @Update&#10;    suspend fun updateProgreso(progreso: ProgresoLeccionEntity)&#10;    &#10;    @Query(&quot;SELECT * FROM progreso_lecciones WHERE usuarioId = :usuarioId&quot;)&#10;    suspend fun getProgresoByUsuario(usuarioId: Int): List&lt;ProgresoLeccionEntity&gt;&#10;    &#10;    @Query(&quot;SELECT * FROM progreso_lecciones WHERE usuarioId = :usuarioId AND leccionId = :leccionId LIMIT 1&quot;)&#10;    suspend fun getProgresoByUsuarioAndLeccion(usuarioId: Int, leccionId: Int): ProgresoLeccionEntity?&#10;    &#10;    @Query(&quot;SELECT COUNT(*) FROM progreso_lecciones WHERE usuarioId = :usuarioId AND completada = 1&quot;)&#10;    suspend fun getLeccionesCompletadasCount(usuarioId: Int): Int&#10;    &#10;    @Query(&quot;SELECT SUM(puntuacion) FROM progreso_lecciones WHERE usuarioId = :usuarioId&quot;)&#10;    suspend fun getTotalPuntos(usuarioId: Int): Int?&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/database/EcoHandDatabase.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/database/EcoHandDatabase.kt" />
              <option name="originalContent" value="package com.example.ecohand.data.local.database&#10;&#10;import android.content.Context&#10;import androidx.room.Database&#10;import androidx.room.Room&#10;import androidx.room.RoomDatabase&#10;import com.example.ecohand.data.local.dao.UserDao&#10;import com.example.ecohand.data.local.entity.UserEntity&#10;&#10;@Database(&#10;    entities = [UserEntity::class],&#10;    version = 1,&#10;    exportSchema = false&#10;)&#10;abstract class EcoHandDatabase : RoomDatabase() {&#10;    &#10;    abstract fun userDao(): UserDao&#10;&#10;    companion object {&#10;        @Volatile&#10;        private var INSTANCE: EcoHandDatabase? = null&#10;        &#10;        fun getDatabase(context: Context): EcoHandDatabase {&#10;            return INSTANCE ?: synchronized(this) {&#10;                val instance = Room.databaseBuilder(&#10;                    context.applicationContext,&#10;                    EcoHandDatabase::class.java,&#10;                    &quot;ecohand_database&quot;&#10;                )&#10;                    .fallbackToDestructiveMigration()&#10;                    .build()&#10;                INSTANCE = instance&#10;                instance&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.ecohand.data.local.database&#10;&#10;import android.content.Context&#10;import androidx.room.Database&#10;import androidx.room.Room&#10;import androidx.room.RoomDatabase&#10;import androidx.sqlite.db.SupportSQLiteDatabase&#10;import com.example.ecohand.data.local.dao.*&#10;import com.example.ecohand.data.local.entity.*&#10;import kotlinx.coroutines.CoroutineScope&#10;import kotlinx.coroutines.Dispatchers&#10;import kotlinx.coroutines.launch&#10;&#10;@Database(&#10;    entities = [&#10;        UserEntity::class,&#10;        LeccionEntity::class,&#10;        ProgresoLeccionEntity::class,&#10;        ActividadDiariaEntity::class,&#10;        LogroEntity::class,&#10;        LogroUsuarioEntity::class,&#10;        EstadisticasUsuarioEntity::class&#10;    ],&#10;    version = 2,&#10;    exportSchema = false&#10;)&#10;abstract class EcoHandDatabase : RoomDatabase() {&#10;    &#10;    abstract fun userDao(): UserDao&#10;    abstract fun leccionDao(): LeccionDao&#10;    abstract fun progresoLeccionDao(): ProgresoLeccionDao&#10;    abstract fun actividadDiariaDao(): ActividadDiariaDao&#10;    abstract fun logroDao(): LogroDao&#10;    abstract fun logroUsuarioDao(): LogroUsuarioDao&#10;    abstract fun estadisticasUsuarioDao(): EstadisticasUsuarioDao&#10;&#10;    companion object {&#10;        @Volatile&#10;        private var INSTANCE: EcoHandDatabase? = null&#10;        &#10;        fun getDatabase(context: Context): EcoHandDatabase {&#10;            return INSTANCE ?: synchronized(this) {&#10;                val instance = Room.databaseBuilder(&#10;                    context.applicationContext,&#10;                    EcoHandDatabase::class.java,&#10;                    &quot;ecohand_database&quot;&#10;                )&#10;                    .fallbackToDestructiveMigration()&#10;                    .addCallback(object : Callback() {&#10;                        override fun onCreate(db: SupportSQLiteDatabase) {&#10;                            super.onCreate(db)&#10;                            INSTANCE?.let { database -&gt;&#10;                                CoroutineScope(Dispatchers.IO).launch {&#10;                                    populateDatabase(database)&#10;                                }&#10;                            }&#10;                        }&#10;                    })&#10;                    .build()&#10;                INSTANCE = instance&#10;                instance&#10;            }&#10;        }&#10;&#10;        private suspend fun populateDatabase(database: EcoHandDatabase) {&#10;            // Insertar lecciones predeterminadas&#10;            val lecciones = listOf(&#10;                LeccionEntity(&#10;                    titulo = &quot;Saludos Básicos&quot;,&#10;                    descripcion = &quot;Aprende los saludos básicos en lengua de señas&quot;,&#10;                    nivel = &quot;BASICO&quot;,&#10;                    orden = 1,&#10;                    icono = &quot;&quot;,&#10;                    bloqueada = false&#10;                ),&#10;                LeccionEntity(&#10;                    titulo = &quot;Alfabeto&quot;,&#10;                    descripcion = &quot;Aprende el alfabeto dactilológico&quot;,&#10;                    nivel = &quot;BASICO&quot;,&#10;                    orden = 2,&#10;                    icono = &quot;&quot;,&#10;                    bloqueada = false&#10;                ),&#10;                LeccionEntity(&#10;                    titulo = &quot;Números&quot;,&#10;                    descripcion = &quot;Aprende los números del 0 al 10&quot;,&#10;                    nivel = &quot;BASICO&quot;,&#10;                    orden = 3,&#10;                    icono = &quot;&quot;,&#10;                    bloqueada = false&#10;                ),&#10;                LeccionEntity(&#10;                    titulo = &quot;Cortesía&quot;,&#10;                    descripcion = &quot;Frases de cortesía en lengua de señas&quot;,&#10;                    nivel = &quot;INTERMEDIO&quot;,&#10;                    orden = 4,&#10;                    icono = &quot;&quot;,&#10;                    bloqueada = false&#10;                ),&#10;                LeccionEntity(&#10;                    titulo = &quot;Familia&quot;,&#10;                    descripcion = &quot;Vocabulario sobre la familia&quot;,&#10;                    nivel = &quot;INTERMEDIO&quot;,&#10;                    orden = 5,&#10;                    icono = &quot;‍‍‍&quot;,&#10;                    bloqueada = false&#10;                )&#10;            )&#10;            database.leccionDao().insertAll(lecciones)&#10;&#10;            // Insertar logros predeterminados&#10;            val logros = listOf(&#10;                LogroEntity(&#10;                    nombre = &quot;Primer Paso&quot;,&#10;                    descripcion = &quot;Completa tu primera lección&quot;,&#10;                    emoji = &quot;&quot;,&#10;                    requisito = &quot;Completar 1 lección&quot;&#10;                ),&#10;                LogroEntity(&#10;                    nombre = &quot;En Racha&quot;,&#10;                    descripcion = &quot;Mantén una racha de 7 días&quot;,&#10;                    emoji = &quot;&quot;,&#10;                    requisito = &quot;7 días consecutivos activos&quot;&#10;                ),&#10;                LogroEntity(&#10;                    nombre = &quot;Experto en Saludos&quot;,&#10;                    descripcion = &quot;Completa la lección de Saludos Básicos&quot;,&#10;                    emoji = &quot;&quot;,&#10;                    requisito = &quot;Completar lección de Saludos&quot;&#10;                ),&#10;                LogroEntity(&#10;                    nombre = &quot;Cortés&quot;,&#10;                    descripcion = &quot;Completa la lección de Cortesía&quot;,&#10;                    emoji = &quot;&quot;,&#10;                    requisito = &quot;Completar lección de Cortesía&quot;&#10;                ),&#10;                LogroEntity(&#10;                    nombre = &quot;Maestro del Alfabeto&quot;,&#10;                    descripcion = &quot;Domina el alfabeto completo&quot;,&#10;                    emoji = &quot;&quot;,&#10;                    requisito = &quot;Completar lección de Alfabeto&quot;&#10;                ),&#10;                LogroEntity(&#10;                    nombre = &quot;Contador Experto&quot;,&#10;                    descripcion = &quot;Aprende los números&quot;,&#10;                    emoji = &quot;&quot;,&#10;                    requisito = &quot;Completar lección de Números&quot;&#10;                ),&#10;                LogroEntity(&#10;                    nombre = &quot;Estudiante Dedicado&quot;,&#10;                    descripcion = &quot;Completa 3 lecciones&quot;,&#10;                    emoji = &quot;&quot;,&#10;                    requisito = &quot;Completar 3 lecciones&quot;&#10;                ),&#10;                LogroEntity(&#10;                    nombre = &quot;Maestro EcoHand&quot;,&#10;                    descripcion = &quot;Completa todas las lecciones&quot;,&#10;                    emoji = &quot;&quot;,&#10;                    requisito = &quot;Completar todas las lecciones&quot;&#10;                )&#10;            )&#10;            database.logroDao().insertAll(logros)&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/entity/ActividadDiariaEntity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/entity/ActividadDiariaEntity.kt" />
              <option name="updatedContent" value="package com.example.ecohand.data.local.entity&#10;&#10;import androidx.room.Entity&#10;import androidx.room.ForeignKey&#10;import androidx.room.Index&#10;import androidx.room.PrimaryKey&#10;&#10;@Entity(&#10;    tableName = &quot;actividad_diaria&quot;,&#10;    foreignKeys = [&#10;        ForeignKey(&#10;            entity = UserEntity::class,&#10;            parentColumns = [&quot;id&quot;],&#10;            childColumns = [&quot;usuarioId&quot;],&#10;            onDelete = ForeignKey.CASCADE&#10;        )&#10;    ],&#10;    indices = [Index(&quot;usuarioId&quot;), Index(&quot;fecha&quot;)]&#10;)&#10;data class ActividadDiariaEntity(&#10;    @PrimaryKey(autoGenerate = true)&#10;    val id: Int = 0,&#10;    val usuarioId: Int,&#10;    val fecha: Long, // Timestamp del día&#10;    val activo: Boolean = true&#10;)&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/entity/EstadisticasUsuarioEntity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/entity/EstadisticasUsuarioEntity.kt" />
              <option name="updatedContent" value="package com.example.ecohand.data.local.entity&#10;&#10;import androidx.room.Entity&#10;import androidx.room.ForeignKey&#10;import androidx.room.Index&#10;import androidx.room.PrimaryKey&#10;&#10;@Entity(&#10;    tableName = &quot;estadisticas_usuario&quot;,&#10;    foreignKeys = [&#10;        ForeignKey(&#10;            entity = UserEntity::class,&#10;            parentColumns = [&quot;id&quot;],&#10;            childColumns = [&quot;usuarioId&quot;],&#10;            onDelete = ForeignKey.CASCADE&#10;        )&#10;    ],&#10;    indices = [Index(&quot;usuarioId&quot;)]&#10;)&#10;data class EstadisticasUsuarioEntity(&#10;    @PrimaryKey(autoGenerate = true)&#10;    val id: Int = 0,&#10;    val usuarioId: Int,&#10;    val puntosTotal: Int = 0,&#10;    val rachaActual: Int = 0,&#10;    val rachaMayor: Int = 0,&#10;    val leccionesCompletadas: Int = 0,&#10;    val diasActivos: Int = 0,&#10;    val ultimaFechaActiva: Long? = null,&#10;    val ultimaActualizacion: Long = System.currentTimeMillis()&#10;)&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/entity/LeccionEntity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/entity/LeccionEntity.kt" />
              <option name="updatedContent" value="package com.example.ecohand.data.local.entity&#10;&#10;import androidx.room.Entity&#10;import androidx.room.PrimaryKey&#10;&#10;@Entity(tableName = &quot;lecciones&quot;)&#10;data class LeccionEntity(&#10;    @PrimaryKey(autoGenerate = true)&#10;    val id: Int = 0,&#10;    val titulo: String,&#10;    val descripcion: String,&#10;    val nivel: String,&#10;    val orden: Int,&#10;    val icono: String? = null,&#10;    val bloqueada: Boolean = true,&#10;    val createdAt: Long = System.currentTimeMillis()&#10;)&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/entity/LogroEntity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/entity/LogroEntity.kt" />
              <option name="updatedContent" value="package com.example.ecohand.data.local.entity&#10;&#10;import androidx.room.Entity&#10;import androidx.room.PrimaryKey&#10;&#10;@Entity(tableName = &quot;logros&quot;)&#10;data class LogroEntity(&#10;    @PrimaryKey(autoGenerate = true)&#10;    val id: Int = 0,&#10;    val nombre: String,&#10;    val descripcion: String,&#10;    val emoji: String,&#10;    val icono: String? = null,&#10;    val requisito: String, // Descripción del requisito para obtenerlo&#10;    val createdAt: Long = System.currentTimeMillis()&#10;)&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/entity/LogroUsuarioEntity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/entity/LogroUsuarioEntity.kt" />
              <option name="updatedContent" value="package com.example.ecohand.data.local.entity&#10;&#10;import androidx.room.Entity&#10;import androidx.room.ForeignKey&#10;import androidx.room.Index&#10;import androidx.room.PrimaryKey&#10;&#10;@Entity(&#10;    tableName = &quot;logros_usuario&quot;,&#10;    foreignKeys = [&#10;        ForeignKey(&#10;            entity = UserEntity::class,&#10;            parentColumns = [&quot;id&quot;],&#10;            childColumns = [&quot;usuarioId&quot;],&#10;            onDelete = ForeignKey.CASCADE&#10;        ),&#10;        ForeignKey(&#10;            entity = LogroEntity::class,&#10;            parentColumns = [&quot;id&quot;],&#10;            childColumns = [&quot;logroId&quot;],&#10;            onDelete = ForeignKey.CASCADE&#10;        )&#10;    ],&#10;    indices = [Index(&quot;usuarioId&quot;), Index(&quot;logroId&quot;)]&#10;)&#10;data class LogroUsuarioEntity(&#10;    @PrimaryKey(autoGenerate = true)&#10;    val id: Int = 0,&#10;    val usuarioId: Int,&#10;    val logroId: Int,&#10;    val obtenido: Boolean = false,&#10;    val fechaObtenido: Long? = null&#10;)&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/entity/ProgresoLeccionEntity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/local/entity/ProgresoLeccionEntity.kt" />
              <option name="updatedContent" value="package com.example.ecohand.data.local.entity&#10;&#10;import androidx.room.Entity&#10;import androidx.room.ForeignKey&#10;import androidx.room.Index&#10;import androidx.room.PrimaryKey&#10;&#10;@Entity(&#10;    tableName = &quot;progreso_lecciones&quot;,&#10;    foreignKeys = [&#10;        ForeignKey(&#10;            entity = UserEntity::class,&#10;            parentColumns = [&quot;id&quot;],&#10;            childColumns = [&quot;usuarioId&quot;],&#10;            onDelete = ForeignKey.CASCADE&#10;        ),&#10;        ForeignKey(&#10;            entity = LeccionEntity::class,&#10;            parentColumns = [&quot;id&quot;],&#10;            childColumns = [&quot;leccionId&quot;],&#10;            onDelete = ForeignKey.CASCADE&#10;        )&#10;    ],&#10;    indices = [Index(&quot;usuarioId&quot;), Index(&quot;leccionId&quot;)]&#10;)&#10;data class ProgresoLeccionEntity(&#10;    @PrimaryKey(autoGenerate = true)&#10;    val id: Int = 0,&#10;    val usuarioId: Int,&#10;    val leccionId: Int,&#10;    val completada: Boolean = false,&#10;    val puntuacion: Int = 0, // 0-100&#10;    val intentos: Int = 0,&#10;    val fechaInicio: Long = System.currentTimeMillis(),&#10;    val fechaCompletado: Long? = null,&#10;    val ultimaActualizacion: Long = System.currentTimeMillis()&#10;)&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/repository/ProgresoRepository.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/repository/ProgresoRepository.kt" />
              <option name="updatedContent" value="package com.example.ecohand.data.repository&#10;&#10;import com.example.ecohand.data.local.dao.*&#10;import com.example.ecohand.data.local.entity.*&#10;import java.util.Calendar&#10;&#10;class ProgresoRepository(&#10;    private val estadisticasUsuarioDao: EstadisticasUsuarioDao,&#10;    private val progresoLeccionDao: ProgresoLeccionDao,&#10;    private val actividadDiariaDao: ActividadDiariaDao,&#10;    private val logroDao: LogroDao,&#10;    private val logroUsuarioDao: LogroUsuarioDao,&#10;    private val leccionDao: LeccionDao&#10;) {&#10;    &#10;    // Obtener o crear estadísticas del usuario&#10;    suspend fun getOrCreateEstadisticas(usuarioId: Int): EstadisticasUsuarioEntity {&#10;        return estadisticasUsuarioDao.getEstadisticasByUsuario(usuarioId)&#10;            ?: EstadisticasUsuarioEntity(usuarioId = usuarioId).also {&#10;                estadisticasUsuarioDao.insertEstadisticas(it)&#10;            }&#10;    }&#10;    &#10;    // Actualizar estadísticas del usuario&#10;    suspend fun updateEstadisticas(estadisticas: EstadisticasUsuarioEntity) {&#10;        estadisticasUsuarioDao.updateEstadisticas(estadisticas)&#10;    }&#10;    &#10;    // Obtener progreso de lecciones del usuario&#10;    suspend fun getProgresoLecciones(usuarioId: Int): List&lt;ProgresoLeccionEntity&gt; {&#10;        return progresoLeccionDao.getProgresoByUsuario(usuarioId)&#10;    }&#10;    &#10;    // Obtener total de lecciones&#10;    suspend fun getTotalLecciones(): Int {&#10;        return leccionDao.getTotalLecciones()&#10;    }&#10;    &#10;    // Obtener lecciones completadas&#10;    suspend fun getLeccionesCompletadas(usuarioId: Int): Int {&#10;        return progresoLeccionDao.getLeccionesCompletadasCount(usuarioId)&#10;    }&#10;    &#10;    // Obtener actividad semanal&#10;    suspend fun getActividadSemanal(usuarioId: Int): List&lt;ActividadDiariaEntity&gt; {&#10;        val calendar = Calendar.getInstance()&#10;        &#10;        // Obtener el inicio de la semana (Lunes)&#10;        calendar.set(Calendar.DAY_OF_WEEK, Calendar.MONDAY)&#10;        calendar.set(Calendar.HOUR_OF_DAY, 0)&#10;        calendar.set(Calendar.MINUTE, 0)&#10;        calendar.set(Calendar.SECOND, 0)&#10;        calendar.set(Calendar.MILLISECOND, 0)&#10;        val inicioSemana = calendar.timeInMillis&#10;        &#10;        // Obtener el fin de la semana (Domingo)&#10;        calendar.add(Calendar.DAY_OF_WEEK, 6)&#10;        calendar.set(Calendar.HOUR_OF_DAY, 23)&#10;        calendar.set(Calendar.MINUTE, 59)&#10;        calendar.set(Calendar.SECOND, 59)&#10;        val finSemana = calendar.timeInMillis&#10;        &#10;        return actividadDiariaDao.getActividadPorRango(usuarioId, inicioSemana, finSemana)&#10;    }&#10;    &#10;    // Registrar actividad del día&#10;    suspend fun registrarActividadDiaria(usuarioId: Int) {&#10;        val calendar = Calendar.getInstance()&#10;        calendar.set(Calendar.HOUR_OF_DAY, 0)&#10;        calendar.set(Calendar.MINUTE, 0)&#10;        calendar.set(Calendar.SECOND, 0)&#10;        calendar.set(Calendar.MILLISECOND, 0)&#10;        val hoy = calendar.timeInMillis&#10;        &#10;        // Verificar si ya existe actividad para hoy&#10;        val actividadExistente = actividadDiariaDao.getActividadPorFecha(usuarioId, hoy)&#10;        if (actividadExistente == null) {&#10;            val nuevaActividad = ActividadDiariaEntity(&#10;                usuarioId = usuarioId,&#10;                fecha = hoy,&#10;                activo = true&#10;            )&#10;            actividadDiariaDao.insertActividad(nuevaActividad)&#10;            &#10;            // Actualizar días activos&#10;            val estadisticas = getOrCreateEstadisticas(usuarioId)&#10;            val diasActivos = actividadDiariaDao.getDiasActivosCount(usuarioId)&#10;            &#10;            // Calcular racha&#10;            val racha = calcularRacha(usuarioId)&#10;            &#10;            val estadisticasActualizadas = estadisticas.copy(&#10;                diasActivos = diasActivos,&#10;                rachaActual = racha,&#10;                rachaMayor = maxOf(estadisticas.rachaMayor, racha),&#10;                ultimaFechaActiva = hoy,&#10;                ultimaActualizacion = System.currentTimeMillis()&#10;            )&#10;            updateEstadisticas(estadisticasActualizadas)&#10;        }&#10;    }&#10;    &#10;    // Calcular racha actual&#10;    private suspend fun calcularRacha(usuarioId: Int): Int {&#10;        val actividades = actividadDiariaDao.getActividadByUsuario(usuarioId)&#10;        if (actividades.isEmpty()) return 0&#10;        &#10;        val calendar = Calendar.getInstance()&#10;        calendar.set(Calendar.HOUR_OF_DAY, 0)&#10;        calendar.set(Calendar.MINUTE, 0)&#10;        calendar.set(Calendar.SECOND, 0)&#10;        calendar.set(Calendar.MILLISECOND, 0)&#10;        &#10;        var racha = 0&#10;        var fechaActual = calendar.timeInMillis&#10;        &#10;        for (actividad in actividades) {&#10;            if (actividad.fecha == fechaActual) {&#10;                racha++&#10;                calendar.add(Calendar.DAY_OF_YEAR, -1)&#10;                fechaActual = calendar.timeInMillis&#10;            } else {&#10;                break&#10;            }&#10;        }&#10;        &#10;        return racha&#10;    }&#10;    &#10;    // Obtener logros del usuario&#10;    suspend fun getLogrosUsuario(usuarioId: Int): List&lt;Pair&lt;LogroEntity, LogroUsuarioEntity&gt;&gt; {&#10;        val logrosUsuario = logroUsuarioDao.getLogrosByUsuario(usuarioId)&#10;        val logros = logroDao.getAllLogros()&#10;        &#10;        // Si el usuario no tiene logros inicializados, crearlos&#10;        if (logrosUsuario.isEmpty() &amp;&amp; logros.isNotEmpty()) {&#10;            logros.forEach { logro -&gt;&#10;                logroUsuarioDao.insertLogroUsuario(&#10;                    LogroUsuarioEntity(&#10;                        usuarioId = usuarioId,&#10;                        logroId = logro.id,&#10;                        obtenido = false&#10;                    )&#10;                )&#10;            }&#10;            return getLogrosUsuario(usuarioId)&#10;        }&#10;        &#10;        return logrosUsuario.mapNotNull { logroUsuario -&gt;&#10;            val logro = logros.find { it.id == logroUsuario.logroId }&#10;            logro?.let { it to logroUsuario }&#10;        }&#10;    }&#10;    &#10;    // Verificar y otorgar logros&#10;    suspend fun verificarLogros(usuarioId: Int) {&#10;        val estadisticas = getOrCreateEstadisticas(usuarioId)&#10;        val logrosUsuario = logroUsuarioDao.getLogrosByUsuario(usuarioId)&#10;        &#10;        logrosUsuario.forEach { logroUsuario -&gt;&#10;            if (!logroUsuario.obtenido) {&#10;                val cumpleRequisito = when (logroUsuario.logroId) {&#10;                    1 -&gt; estadisticas.leccionesCompletadas &gt;= 1 // Primer Paso&#10;                    2 -&gt; estadisticas.rachaActual &gt;= 7 // En Racha&#10;                    3, 4, 5, 6 -&gt; verificarLeccionEspecifica(usuarioId, logroUsuario.logroId - 2)&#10;                    7 -&gt; estadisticas.leccionesCompletadas &gt;= 3 // Estudiante Dedicado&#10;                    8 -&gt; estadisticas.leccionesCompletadas &gt;= 5 // Maestro EcoHand&#10;                    else -&gt; false&#10;                }&#10;                &#10;                if (cumpleRequisito) {&#10;                    logroUsuarioDao.updateLogroUsuario(&#10;                        logroUsuario.copy(&#10;                            obtenido = true,&#10;                            fechaObtenido = System.currentTimeMillis()&#10;                        )&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;    &#10;    private suspend fun verificarLeccionEspecifica(usuarioId: Int, leccionId: Int): Boolean {&#10;        val progreso = progresoLeccionDao.getProgresoByUsuarioAndLeccion(usuarioId, leccionId)&#10;        return progreso?.completada == true&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/session/UserSession.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/data/session/UserSession.kt" />
              <option name="updatedContent" value="package com.example.ecohand.data.session&#10;&#10;import android.content.Context&#10;import android.content.SharedPreferences&#10;&#10;class UserSession(context: Context) {&#10;    private val prefs: SharedPreferences = context.getSharedPreferences(&#10;        &quot;ecohand_session&quot;,&#10;        Context.MODE_PRIVATE&#10;    )&#10;    &#10;    companion object {&#10;        private const val KEY_USER_ID = &quot;user_id&quot;&#10;        private const val KEY_USERNAME = &quot;username&quot;&#10;        private const val KEY_EMAIL = &quot;email&quot;&#10;        private const val KEY_IS_LOGGED_IN = &quot;is_logged_in&quot;&#10;        &#10;        @Volatile&#10;        private var INSTANCE: UserSession? = null&#10;        &#10;        fun getInstance(context: Context): UserSession {&#10;            return INSTANCE ?: synchronized(this) {&#10;                INSTANCE ?: UserSession(context.applicationContext).also {&#10;                    INSTANCE = it&#10;                }&#10;            }&#10;        }&#10;    }&#10;    &#10;    fun saveUserSession(userId: Int, username: String, email: String) {&#10;        prefs.edit().apply {&#10;            putInt(KEY_USER_ID, userId)&#10;            putString(KEY_USERNAME, username)&#10;            putString(KEY_EMAIL, email)&#10;            putBoolean(KEY_IS_LOGGED_IN, true)&#10;            apply()&#10;        }&#10;    }&#10;    &#10;    fun getUserId(): Int {&#10;        return prefs.getInt(KEY_USER_ID, -1)&#10;    }&#10;    &#10;    fun getUsername(): String? {&#10;        return prefs.getString(KEY_USERNAME, null)&#10;    }&#10;    &#10;    fun getEmail(): String? {&#10;        return prefs.getString(KEY_EMAIL, null)&#10;    }&#10;    &#10;    fun isLoggedIn(): Boolean {&#10;        return prefs.getBoolean(KEY_IS_LOGGED_IN, false)&#10;    }&#10;    &#10;    fun clearSession() {&#10;        prefs.edit().apply {&#10;            clear()&#10;            apply()&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/navigation/AppNavigation.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/navigation/AppNavigation.kt" />
              <option name="originalContent" value="package com.example.ecohand.navigation&#10;&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.rememberNavController&#10;import com.example.ecohand.data.local.database.EcoHandDatabase&#10;import com.example.ecohand.data.repository.UserRepository&#10;import com.example.ecohand.presentation.login.LoginScreen&#10;import com.example.ecohand.presentation.login.LoginViewModel&#10;import com.example.ecohand.presentation.main.MainScreen&#10;import com.example.ecohand.presentation.splash.SplashScreen&#10;&#10;@Composable&#10;fun AppNavigation() {&#10;    val navController = rememberNavController()&#10;    val context = LocalContext.current&#10;    &#10;    // Inicializar base de datos y repositorio&#10;    val database = EcoHandDatabase.getDatabase(context)&#10;    val userRepository = UserRepository(database.userDao())&#10;    val loginViewModel = LoginViewModel(userRepository)&#10;    &#10;    NavHost(&#10;        navController = navController,&#10;        startDestination = Screen.Splash.route&#10;    ) {&#10;        composable(Screen.Splash.route) {&#10;            SplashScreen(&#10;                onNavigateToLogin = {&#10;                    navController.navigate(Screen.Login.route) {&#10;                        popUpTo(Screen.Splash.route) { inclusive = true }&#10;                    }&#10;                }&#10;            )&#10;        }&#10;        &#10;        composable(Screen.Login.route) {&#10;            LoginScreen(&#10;                viewModel = loginViewModel,&#10;                onNavigateToHome = {&#10;                    navController.navigate(Screen.Home.route) {&#10;                        popUpTo(Screen.Login.route) { inclusive = true }&#10;                    }&#10;                }&#10;            )&#10;        }&#10;        &#10;        composable(Screen.Home.route) {&#10;            MainScreen()&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.ecohand.navigation&#10;&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.rememberNavController&#10;import com.example.ecohand.data.local.database.EcoHandDatabase&#10;import com.example.ecohand.data.repository.UserRepository&#10;import com.example.ecohand.data.session.UserSession&#10;import com.example.ecohand.presentation.login.LoginScreen&#10;import com.example.ecohand.presentation.login.LoginViewModel&#10;import com.example.ecohand.presentation.main.MainScreen&#10;import com.example.ecohand.presentation.splash.SplashScreen&#10;&#10;@Composable&#10;fun AppNavigation() {&#10;    val navController = rememberNavController()&#10;    val context = LocalContext.current&#10;    &#10;    // Inicializar base de datos, repositorio y sesión&#10;    val database = EcoHandDatabase.getDatabase(context)&#10;    val userRepository = UserRepository(database.userDao())&#10;    val userSession = UserSession.getInstance(context)&#10;    val loginViewModel = LoginViewModel(userRepository, userSession)&#10;    &#10;    NavHost(&#10;        navController = navController,&#10;        startDestination = Screen.Splash.route&#10;    ) {&#10;        composable(Screen.Splash.route) {&#10;            SplashScreen(&#10;                onNavigateToLogin = {&#10;                    navController.navigate(Screen.Login.route) {&#10;                        popUpTo(Screen.Splash.route) { inclusive = true }&#10;                    }&#10;                }&#10;            )&#10;        }&#10;        &#10;        composable(Screen.Login.route) {&#10;            LoginScreen(&#10;                viewModel = loginViewModel,&#10;                onNavigateToHome = {&#10;                    navController.navigate(Screen.Home.route) {&#10;                        popUpTo(Screen.Login.route) { inclusive = true }&#10;                    }&#10;                }&#10;            )&#10;        }&#10;        &#10;        composable(Screen.Home.route) {&#10;            MainScreen()&#10;        }&#10;    }&#10;}&#13;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/presentation/login/LoginViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/presentation/login/LoginViewModel.kt" />
              <option name="originalContent" value="package com.example.ecohand.presentation.login&#10;&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.ecohand.data.repository.UserRepository&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.launch&#10;&#10;data class LoginUiState(&#10;    val email: String = &quot;&quot;,&#10;    val password: String = &quot;&quot;,&#10;    val isLoading: Boolean = false,&#10;    val errorMessage: String? = null,&#10;    val isLoginSuccessful: Boolean = false,&#10;    val isRegistering: Boolean = false,&#10;    val username: String = &quot;&quot;&#10;)&#10;&#10;class LoginViewModel(private val userRepository: UserRepository) : ViewModel() {&#10;    &#10;    private val _uiState = MutableStateFlow(LoginUiState())&#10;    val uiState: StateFlow&lt;LoginUiState&gt; = _uiState.asStateFlow()&#10;    &#10;    fun onEmailChange(email: String) {&#10;        _uiState.value = _uiState.value.copy(email = email, errorMessage = null)&#10;    }&#10;    &#10;    fun onPasswordChange(password: String) {&#10;        _uiState.value = _uiState.value.copy(password = password, errorMessage = null)&#10;    }&#10;    &#10;    fun onUsernameChange(username: String) {&#10;        _uiState.value = _uiState.value.copy(username = username, errorMessage = null)&#10;    }&#10;    &#10;    fun toggleRegistering() {&#10;        _uiState.value = _uiState.value.copy(&#10;            isRegistering = !_uiState.value.isRegistering,&#10;            errorMessage = null&#10;        )&#10;    }&#10;    &#10;    fun login() {&#10;        val currentState = _uiState.value&#10;        &#10;        if (currentState.email.isBlank() || currentState.password.isBlank()) {&#10;            _uiState.value = currentState.copy(errorMessage = &quot;Por favor complete todos los campos&quot;)&#10;            return&#10;        }&#10;        &#10;        viewModelScope.launch {&#10;            _uiState.value = currentState.copy(isLoading = true, errorMessage = null)&#10;            &#10;            val result = userRepository.login(currentState.email, currentState.password)&#10;            &#10;            _uiState.value = if (result.isSuccess) {&#10;                currentState.copy(isLoading = false, isLoginSuccessful = true)&#10;            } else {&#10;                currentState.copy(&#10;                    isLoading = false,&#10;                    errorMessage = result.exceptionOrNull()?.message ?: &quot;Error al iniciar sesión&quot;&#10;                )&#10;            }&#10;        }&#10;    }&#10;    &#10;    fun register() {&#10;        val currentState = _uiState.value&#10;        &#10;        if (currentState.username.isBlank() || currentState.email.isBlank() || currentState.password.isBlank()) {&#10;            _uiState.value = currentState.copy(errorMessage = &quot;Por favor complete todos los campos&quot;)&#10;            return&#10;        }&#10;        &#10;        if (currentState.password.length &lt; 6) {&#10;            _uiState.value = currentState.copy(errorMessage = &quot;La contraseña debe tener al menos 6 caracteres&quot;)&#10;            return&#10;        }&#10;        &#10;        viewModelScope.launch {&#10;            _uiState.value = currentState.copy(isLoading = true, errorMessage = null)&#10;            &#10;            val result = userRepository.registerUser(&#10;                currentState.username,&#10;                currentState.email,&#10;                currentState.password&#10;            )&#10;            &#10;            _uiState.value = if (result.isSuccess) {&#10;                currentState.copy(isLoading = false, isLoginSuccessful = true)&#10;            } else {&#10;                currentState.copy(&#10;                    isLoading = false,&#10;                    errorMessage = result.exceptionOrNull()?.message ?: &quot;Error al registrar usuario&quot;&#10;                )&#10;            }&#10;        }&#10;    }&#10;    &#10;    fun clearError() {&#10;        _uiState.value = _uiState.value.copy(errorMessage = null)&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.ecohand.presentation.login&#10;&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.ecohand.data.repository.UserRepository&#10;import com.example.ecohand.data.session.UserSession&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.launch&#10;&#10;data class LoginUiState(&#10;    val email: String = &quot;&quot;,&#10;    val password: String = &quot;&quot;,&#10;    val isLoading: Boolean = false,&#10;    val errorMessage: String? = null,&#10;    val isLoginSuccessful: Boolean = false,&#10;    val isRegistering: Boolean = false,&#10;    val username: String = &quot;&quot;&#10;)&#10;&#10;class LoginViewModel(&#10;    private val userRepository: UserRepository,&#10;    private val userSession: UserSession&#10;) : ViewModel() {&#10;    &#10;    private val _uiState = MutableStateFlow(LoginUiState())&#10;    val uiState: StateFlow&lt;LoginUiState&gt; = _uiState.asStateFlow()&#10;    &#10;    fun onEmailChange(email: String) {&#10;        _uiState.value = _uiState.value.copy(email = email, errorMessage = null)&#10;    }&#10;    &#10;    fun onPasswordChange(password: String) {&#10;        _uiState.value = _uiState.value.copy(password = password, errorMessage = null)&#10;    }&#10;    &#10;    fun onUsernameChange(username: String) {&#10;        _uiState.value = _uiState.value.copy(username = username, errorMessage = null)&#10;    }&#10;    &#10;    fun toggleRegistering() {&#10;        _uiState.value = _uiState.value.copy(&#10;            isRegistering = !_uiState.value.isRegistering,&#10;            errorMessage = null&#10;        )&#10;    }&#10;    &#10;    fun login() {&#10;        val currentState = _uiState.value&#10;        &#10;        if (currentState.email.isBlank() || currentState.password.isBlank()) {&#10;            _uiState.value = currentState.copy(errorMessage = &quot;Por favor complete todos los campos&quot;)&#10;            return&#10;        }&#10;        &#10;        viewModelScope.launch {&#10;            _uiState.value = currentState.copy(isLoading = true, errorMessage = null)&#10;            &#10;            val result = userRepository.login(currentState.email, currentState.password)&#10;            &#10;            _uiState.value = if (result.isSuccess) {&#10;                val user = result.getOrNull()&#10;                if (user != null) {&#10;                    userSession.saveUserSession(user.id, user.username, user.email)&#10;                }&#10;                currentState.copy(isLoading = false, isLoginSuccessful = true)&#10;            } else {&#10;                currentState.copy(&#10;                    isLoading = false,&#10;                    errorMessage = result.exceptionOrNull()?.message ?: &quot;Error al iniciar sesión&quot;&#10;                )&#10;            }&#10;        }&#10;    }&#10;    &#10;    fun register() {&#10;        val currentState = _uiState.value&#10;        &#10;        if (currentState.username.isBlank() || currentState.email.isBlank() || currentState.password.isBlank()) {&#10;            _uiState.value = currentState.copy(errorMessage = &quot;Por favor complete todos los campos&quot;)&#10;            return&#10;        }&#10;        &#10;        if (currentState.password.length &lt; 6) {&#10;            _uiState.value = currentState.copy(errorMessage = &quot;La contraseña debe tener al menos 6 caracteres&quot;)&#10;            return&#10;        }&#10;        &#10;        viewModelScope.launch {&#10;            _uiState.value = currentState.copy(isLoading = true, errorMessage = null)&#10;            &#10;            val result = userRepository.registerUser(&#10;                currentState.username,&#10;                currentState.email,&#10;                currentState.password&#10;            )&#10;            &#10;            _uiState.value = if (result.isSuccess) {&#10;                val userId = result.getOrNull()&#10;                if (userId != null) {&#10;                    userSession.saveUserSession(userId.toInt(), currentState.username, currentState.email)&#10;                }&#10;                currentState.copy(isLoading = false, isLoginSuccessful = true)&#10;            } else {&#10;                currentState.copy(&#10;                    isLoading = false,&#10;                    errorMessage = result.exceptionOrNull()?.message ?: &quot;Error al registrar usuario&quot;&#10;                )&#10;            }&#10;        }&#10;    }&#10;    &#10;    fun clearError() {&#10;        _uiState.value = _uiState.value.copy(errorMessage = null)&#10;    }&#10;}&#13;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/presentation/main/MainScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/presentation/main/MainScreen.kt" />
              <option name="originalContent" value="package com.example.ecohand.presentation.main&#10;&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material3.Icon&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.NavigationBar&#10;import androidx.compose.material3.NavigationBarItem&#10;import androidx.compose.material3.NavigationBarItemDefaults&#10;import androidx.compose.material3.Scaffold&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.ui.Modifier&#10;import androidx.navigation.NavHostController&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.currentBackStackEntryAsState&#10;import androidx.navigation.compose.rememberNavController&#10;import com.example.ecohand.navigation.BottomNavItem&#10;import com.example.ecohand.navigation.Screen&#10;import com.example.ecohand.navigation.bottomNavItems&#10;import com.example.ecohand.presentation.home.InicioScreen&#10;import com.example.ecohand.presentation.juegos.JuegosScreen&#10;import com.example.ecohand.presentation.lecciones.LeccionesScreen&#10;import com.example.ecohand.presentation.perfil.PerfilScreen&#10;import com.example.ecohand.presentation.progreso.ProgresoScreen&#10;&#10;@Composable&#10;fun MainScreen() {&#10;    val navController = rememberNavController()&#10;&#10;    Scaffold(&#10;        bottomBar = { BottomNavigationBar(navController = navController) }&#10;    ) { innerPadding -&gt;&#10;        MainNavHost(&#10;            navController = navController,&#10;            modifier = Modifier.padding(innerPadding)&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;fun BottomNavigationBar(navController: NavHostController) {&#10;    val navBackStackEntry by navController.currentBackStackEntryAsState()&#10;    val currentRoute = navBackStackEntry?.destination?.route&#10;    &#10;    NavigationBar(&#10;        containerColor = MaterialTheme.colorScheme.primary,&#10;        contentColor = MaterialTheme.colorScheme.onPrimary&#10;    ) {&#10;        bottomNavItems.forEach { item -&gt;&#10;            val isSelected = currentRoute == item.route&#10;            NavigationBarItem(&#10;                icon = {&#10;                    Icon(&#10;                        imageVector = if (isSelected) item.selectedIcon else item.icon,&#10;                        contentDescription = item.title&#10;                    )&#10;                },&#10;                label = { Text(text = item.title) },&#10;                selected = isSelected,&#10;                onClick = {&#10;                    navController.navigate(item.route) {&#10;                        navController.graph.startDestinationRoute?.let { route -&gt;&#10;                            popUpTo(route) {&#10;                                saveState = true&#10;                            }&#10;                        }&#10;                        launchSingleTop = true&#10;                        restoreState = true&#10;                    }&#10;                },&#10;                colors = NavigationBarItemDefaults.colors(&#10;                    selectedIconColor = MaterialTheme.colorScheme.onPrimary,&#10;                    selectedTextColor = MaterialTheme.colorScheme.onPrimary,&#10;                    unselectedIconColor = MaterialTheme.colorScheme.onPrimary.copy(alpha = 0.6f),&#10;                    unselectedTextColor = MaterialTheme.colorScheme.onPrimary.copy(alpha = 0.6f),&#10;                    indicatorColor = MaterialTheme.colorScheme.secondary&#10;                )&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun MainNavHost(&#10;    navController: NavHostController,&#10;    modifier: Modifier = Modifier&#10;) {&#10;    NavHost(&#10;        navController = navController,&#10;        startDestination = Screen.Inicio.route,&#10;        modifier = modifier&#10;    ) {&#10;        composable(Screen.Inicio.route) {&#10;            InicioScreen()&#10;        }&#10;        composable(Screen.Lecciones.route) {&#10;            LeccionesScreen()&#10;        }&#10;        composable(Screen.Progreso.route) {&#10;            ProgresoScreen()&#10;        }&#10;        composable(Screen.Juegos.route) {&#10;            JuegosScreen()&#10;        }&#10;        composable(Screen.Perfil.route) {&#10;            PerfilScreen()&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.ecohand.presentation.main&#10;&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material3.Icon&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.NavigationBar&#10;import androidx.compose.material3.NavigationBarItem&#10;import androidx.compose.material3.NavigationBarItemDefaults&#10;import androidx.compose.material3.Scaffold&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.navigation.NavHostController&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.currentBackStackEntryAsState&#10;import androidx.navigation.compose.rememberNavController&#10;import com.example.ecohand.data.local.database.EcoHandDatabase&#10;import com.example.ecohand.data.repository.ProgresoRepository&#10;import com.example.ecohand.data.session.UserSession&#10;import com.example.ecohand.navigation.Screen&#10;import com.example.ecohand.navigation.bottomNavItems&#10;import com.example.ecohand.presentation.home.InicioScreen&#10;import com.example.ecohand.presentation.juegos.JuegosScreen&#10;import com.example.ecohand.presentation.lecciones.LeccionesScreen&#10;import com.example.ecohand.presentation.perfil.PerfilScreen&#10;import com.example.ecohand.presentation.progreso.ProgresoScreen&#10;import com.example.ecohand.presentation.progreso.ProgresoViewModel&#10;&#10;@Composable&#10;fun MainScreen() {&#10;    val navController = rememberNavController()&#10;    val context = LocalContext.current&#10;&#10;    // Inicializar base de datos y repositorios&#10;    val database = EcoHandDatabase.getDatabase(context)&#10;    val userSession = UserSession.getInstance(context)&#10;    val usuarioId = userSession.getUserId()&#10;&#10;    // Crear ProgresoRepository&#10;    val progresoRepository = ProgresoRepository(&#10;        estadisticasUsuarioDao = database.estadisticasUsuarioDao(),&#10;        progresoLeccionDao = database.progresoLeccionDao(),&#10;        actividadDiariaDao = database.actividadDiariaDao(),&#10;        logroDao = database.logroDao(),&#10;        logroUsuarioDao = database.logroUsuarioDao(),&#10;        leccionDao = database.leccionDao()&#10;    )&#10;&#10;    // Crear ProgresoViewModel con remember para evitar recreaciones&#10;    val progresoViewModel = remember(usuarioId) {&#10;        ProgresoViewModel(progresoRepository, usuarioId)&#10;    }&#10;&#10;    Scaffold(&#10;        bottomBar = { BottomNavigationBar(navController = navController) }&#10;    ) { innerPadding -&gt;&#10;        MainNavHost(&#10;            navController = navController,&#10;            progresoViewModel = progresoViewModel,&#10;            modifier = Modifier.padding(innerPadding)&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;fun BottomNavigationBar(navController: NavHostController) {&#10;    val navBackStackEntry by navController.currentBackStackEntryAsState()&#10;    val currentRoute = navBackStackEntry?.destination?.route&#10;    &#10;    NavigationBar(&#10;        containerColor = MaterialTheme.colorScheme.primary,&#10;        contentColor = MaterialTheme.colorScheme.onPrimary&#10;    ) {&#10;        bottomNavItems.forEach { item -&gt;&#10;            val isSelected = currentRoute == item.route&#10;            NavigationBarItem(&#10;                icon = {&#10;                    Icon(&#10;                        imageVector = if (isSelected) item.selectedIcon else item.icon,&#10;                        contentDescription = item.title&#10;                    )&#10;                },&#10;                label = { Text(text = item.title) },&#10;                selected = isSelected,&#10;                onClick = {&#10;                    navController.navigate(item.route) {&#10;                        navController.graph.startDestinationRoute?.let { route -&gt;&#10;                            popUpTo(route) {&#10;                                saveState = true&#10;                            }&#10;                        }&#10;                        launchSingleTop = true&#10;                        restoreState = true&#10;                    }&#10;                },&#10;                colors = NavigationBarItemDefaults.colors(&#10;                    selectedIconColor = MaterialTheme.colorScheme.onPrimary,&#10;                    selectedTextColor = MaterialTheme.colorScheme.onPrimary,&#10;                    unselectedIconColor = MaterialTheme.colorScheme.onPrimary.copy(alpha = 0.6f),&#10;                    unselectedTextColor = MaterialTheme.colorScheme.onPrimary.copy(alpha = 0.6f),&#10;                    indicatorColor = MaterialTheme.colorScheme.secondary&#10;                )&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun MainNavHost(&#10;    navController: NavHostController,&#10;    progresoViewModel: ProgresoViewModel,&#10;    modifier: Modifier = Modifier&#10;) {&#10;    NavHost(&#10;        navController = navController,&#10;        startDestination = Screen.Inicio.route,&#10;        modifier = modifier&#10;    ) {&#10;        composable(Screen.Inicio.route) {&#10;            InicioScreen()&#10;        }&#10;        composable(Screen.Lecciones.route) {&#10;            LeccionesScreen()&#10;        }&#10;        composable(Screen.Progreso.route) {&#10;            ProgresoScreen(viewModel = progresoViewModel)&#10;        }&#10;        composable(Screen.Juegos.route) {&#10;            JuegosScreen()&#10;        }&#10;        composable(Screen.Perfil.route) {&#10;            PerfilScreen()&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/presentation/progreso/ProgresoScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/presentation/progreso/ProgresoScreen.kt" />
              <option name="originalContent" value="package com.example.ecohand.presentation.progreso&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.sp&#10;&#10;@Composable&#10;fun ProgresoScreen() {&#10;    Box(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .background(MaterialTheme.colorScheme.background),&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        Text(&#10;            text = &quot;Progreso&quot;,&#10;            fontSize = 32.sp,&#10;            fontWeight = FontWeight.Bold,&#10;            color = MaterialTheme.colorScheme.primary&#10;        )&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.ecohand.presentation.progreso&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;&#10;@Composable&#10;fun ProgresoScreen(viewModel: ProgresoViewModel) {&#10;    val uiState by viewModel.uiState.collectAsState()&#10;&#10;    Box(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .background(MaterialTheme.colorScheme.background)&#10;    ) {&#10;        if (uiState.isLoading) {&#10;            CircularProgressIndicator(&#10;                modifier = Modifier.align(Alignment.Center),&#10;                color = MaterialTheme.colorScheme.primary&#10;            )&#10;        } else {&#10;            LazyColumn(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .padding(16.dp),&#10;                verticalArrangement = Arrangement.spacedBy(16.dp)&#10;            ) {&#10;                // Título&#10;                item {&#10;                    Text(&#10;                        text = &quot;Mi Progreso&quot;,&#10;                        fontSize = 28.sp,&#10;                        fontWeight = FontWeight.Bold,&#10;                        color = MaterialTheme.colorScheme.primary,&#10;                        modifier = Modifier.padding(vertical = 8.dp)&#10;                    )&#10;                }&#10;&#10;                // Card de Progreso General&#10;                item {&#10;                    ProgresoGeneralCard(&#10;                        leccionesCompletadas = uiState.leccionesCompletadas,&#10;                        totalLecciones = uiState.totalLecciones,&#10;                        porcentaje = uiState.porcentajeProgreso&#10;                    )&#10;                }&#10;&#10;                // Grid de estadísticas 2x2&#10;                item {&#10;                    EstadisticasGrid(&#10;                        puntosTotal = uiState.puntosTotal,&#10;                        racha = uiState.rachaActual,&#10;                        lecciones = uiState.leccionesCount,&#10;                        diasActivos = uiState.diasActivos&#10;                    )&#10;                }&#10;&#10;                // Card de Actividad Semanal&#10;                item {&#10;                    ActividadSemanalCard(actividades = uiState.actividadSemanal)&#10;                }&#10;&#10;                // Card de Logros&#10;                item {&#10;                    LogrosCard(logros = uiState.logros)&#10;                }&#10;&#10;                // Espaciado final&#10;                item {&#10;                    Spacer(modifier = Modifier.height(16.dp))&#10;                }&#10;            }&#10;        }&#10;&#10;        // Mostrar error si existe&#10;        uiState.errorMessage?.let { error -&gt;&#10;            Snackbar(&#10;                modifier = Modifier&#10;                    .align(Alignment.BottomCenter)&#10;                    .padding(16.dp),&#10;                action = {&#10;                    TextButton(onClick = { viewModel.cargarProgreso() }) {&#10;                        Text(&quot;Reintentar&quot;)&#10;                    }&#10;                }&#10;            ) {&#10;                Text(error)&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ProgresoGeneralCard(&#10;    leccionesCompletadas: Int,&#10;    totalLecciones: Int,&#10;    porcentaje: Float&#10;) {&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(vertical = 8.dp),&#10;        shape = RoundedCornerShape(16.dp),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = MaterialTheme.colorScheme.surface&#10;        ),&#10;        elevation = CardDefaults.cardElevation(defaultElevation = 4.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(20.dp),&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&#10;                text = &quot;Progreso General&quot;,&#10;                fontSize = 20.sp,&#10;                fontWeight = FontWeight.Bold,&#10;                color = MaterialTheme.colorScheme.primary&#10;            )&#10;&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;            &#10;            // Barra de progreso&#10;            LinearProgressIndicator(&#10;                progress = { porcentaje },&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .height(12.dp)&#10;                    .clip(RoundedCornerShape(6.dp)),&#10;                color = MaterialTheme.colorScheme.primary,&#10;                trackColor = MaterialTheme.colorScheme.surfaceVariant&#10;            )&#10;            &#10;            Spacer(modifier = Modifier.height(12.dp))&#10;&#10;            Text(&#10;                text = &quot;$leccionesCompletadas de $totalLecciones lecciones completadas (${(porcentaje * 100).toInt()}%)&quot;,&#10;                fontSize = 16.sp,&#10;                color = MaterialTheme.colorScheme.onSurface,&#10;                textAlign = TextAlign.Center&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun EstadisticasGrid(&#10;    puntosTotal: Int,&#10;    racha: Int,&#10;    lecciones: Int,&#10;    diasActivos: Int&#10;) {&#10;    Column(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        verticalArrangement = Arrangement.spacedBy(12.dp)&#10;    ) {&#10;        // Primera fila&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;        ) {&#10;            EstadisticaCard(&#10;                emoji = &quot;⭐&quot;,&#10;                titulo = &quot;Puntos Total&quot;,&#10;                valor = puntosTotal.toString(),&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;&#10;            EstadisticaCard(&#10;                emoji = &quot;&quot;,&#10;                titulo = &quot;Racha&quot;,&#10;                valor = &quot;$racha días&quot;,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;        }&#10;&#10;        // Segunda fila&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;        ) {&#10;            EstadisticaCard(&#10;                emoji = &quot;&quot;,&#10;                titulo = &quot;Lecciones&quot;,&#10;                valor = lecciones.toString(),&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;&#10;            EstadisticaCard(&#10;                emoji = &quot;&quot;,&#10;                titulo = &quot;Días Activos&quot;,&#10;                valor = diasActivos.toString(),&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun EstadisticaCard(&#10;    emoji: String,&#10;    titulo: String,&#10;    valor: String,&#10;    modifier: Modifier = Modifier&#10;) {&#10;    Card(&#10;        modifier = modifier.height(120.dp),&#10;        shape = RoundedCornerShape(16.dp),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = MaterialTheme.colorScheme.surface&#10;        ),&#10;        elevation = CardDefaults.cardElevation(defaultElevation = 4.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(12.dp),&#10;            horizontalAlignment = Alignment.CenterHorizontally,&#10;            verticalArrangement = Arrangement.Center&#10;        ) {&#10;            Text(&#10;                text = emoji,&#10;                fontSize = 32.sp&#10;            )&#10;&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;&#10;            Text(&#10;                text = titulo,&#10;                fontSize = 12.sp,&#10;                color = MaterialTheme.colorScheme.onSurfaceVariant,&#10;                textAlign = TextAlign.Center&#10;            )&#10;&#10;            Text(&#10;                text = valor,&#10;                fontSize = 18.sp,&#10;                fontWeight = FontWeight.Bold,&#10;                color = MaterialTheme.colorScheme.primary,&#10;                textAlign = TextAlign.Center&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ActividadSemanalCard(actividades: List&lt;DiaActividad&gt;) {&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(vertical = 8.dp),&#10;        shape = RoundedCornerShape(16.dp),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = MaterialTheme.colorScheme.surface&#10;        ),&#10;        elevation = CardDefaults.cardElevation(defaultElevation = 4.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(20.dp)&#10;        ) {&#10;            Text(&#10;                text = &quot;Actividad Semanal&quot;,&#10;                fontSize = 20.sp,&#10;                fontWeight = FontWeight.Bold,&#10;                color = MaterialTheme.colorScheme.primary&#10;            )&#10;&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                horizontalArrangement = Arrangement.SpaceEvenly&#10;            ) {&#10;                actividades.forEach { diaActividad -&gt;&#10;                    DiaActividadItem(diaActividad)&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun DiaActividadItem(diaActividad: DiaActividad) {&#10;    Column(&#10;        horizontalAlignment = Alignment.CenterHorizontally,&#10;        verticalArrangement = Arrangement.spacedBy(4.dp)&#10;    ) {&#10;        Text(&#10;            text = diaActividad.dia,&#10;            fontSize = 12.sp,&#10;            color = MaterialTheme.colorScheme.onSurfaceVariant&#10;        )&#10;&#10;        Box(&#10;            modifier = Modifier&#10;                .size(40.dp)&#10;                .clip(CircleShape)&#10;                .background(&#10;                    if (diaActividad.activo)&#10;                        MaterialTheme.colorScheme.primary&#10;                    else&#10;                        MaterialTheme.colorScheme.surfaceVariant&#10;                ),&#10;            contentAlignment = Alignment.Center&#10;        ) {&#10;            if (diaActividad.activo) {&#10;                Text(&#10;                    text = &quot;✓&quot;,&#10;                    fontSize = 18.sp,&#10;                    color = Color.White,&#10;                    fontWeight = FontWeight.Bold&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun LogrosCard(logros: List&lt;LogroConEstado&gt;) {&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(vertical = 8.dp),&#10;        shape = RoundedCornerShape(16.dp),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = MaterialTheme.colorScheme.surface&#10;        ),&#10;        elevation = CardDefaults.cardElevation(defaultElevation = 4.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(20.dp)&#10;        ) {&#10;            Text(&#10;                text = &quot;Logros&quot;,&#10;                fontSize = 20.sp,&#10;                fontWeight = FontWeight.Bold,&#10;                color = MaterialTheme.colorScheme.primary&#10;            )&#10;&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;&#10;            if (logros.isEmpty()) {&#10;                Text(&#10;                    text = &quot;¡Completa lecciones para desbloquear logros!&quot;,&#10;                    fontSize = 14.sp,&#10;                    color = MaterialTheme.colorScheme.onSurfaceVariant,&#10;                    textAlign = TextAlign.Center,&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .padding(vertical = 16.dp)&#10;                )&#10;            } else {&#10;                Column(&#10;                    verticalArrangement = Arrangement.spacedBy(12.dp)&#10;                ) {&#10;                    logros.forEach { logroConEstado -&gt;&#10;                        LogroItem(logroConEstado)&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun LogroItem(logroConEstado: LogroConEstado) {&#10;    Row(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .background(&#10;                color = if (logroConEstado.obtenido)&#10;                    MaterialTheme.colorScheme.primaryContainer.copy(alpha = 0.3f)&#10;                else&#10;                    MaterialTheme.colorScheme.surfaceVariant.copy(alpha = 0.5f),&#10;                shape = RoundedCornerShape(12.dp)&#10;            )&#10;            .padding(12.dp),&#10;        verticalAlignment = Alignment.CenterVertically&#10;    ) {&#10;        // Emoji del logro&#10;        Text(&#10;            text = logroConEstado.logro.emoji,&#10;            fontSize = 32.sp,&#10;            modifier = Modifier.padding(end = 12.dp)&#10;        )&#10;&#10;        // Información del logro&#10;        Column(&#10;            modifier = Modifier.weight(1f)&#10;        ) {&#10;            Text(&#10;                text = logroConEstado.logro.nombre,&#10;                fontSize = 16.sp,&#10;                fontWeight = FontWeight.Bold,&#10;                color = if (logroConEstado.obtenido)&#10;                    MaterialTheme.colorScheme.primary&#10;                else&#10;                    MaterialTheme.colorScheme.onSurfaceVariant&#10;            )&#10;&#10;            Text(&#10;                text = logroConEstado.logro.descripcion,&#10;                fontSize = 12.sp,&#10;                color = MaterialTheme.colorScheme.onSurfaceVariant&#10;            )&#10;        }&#10;&#10;        // Indicador de obtenido&#10;        if (logroConEstado.obtenido) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .size(24.dp)&#10;                    .clip(CircleShape)&#10;                    .background(MaterialTheme.colorScheme.primary),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Text(&#10;                    text = &quot;✓&quot;,&#10;                    fontSize = 14.sp,&#10;                    color = Color.White,&#10;                    fontWeight = FontWeight.Bold&#10;                )&#10;            }&#10;        } else {&#10;            Box(&#10;                modifier = Modifier&#10;                    .size(24.dp)&#10;                    .clip(CircleShape)&#10;                    .background(MaterialTheme.colorScheme.surfaceVariant)&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/presentation/progreso/ProgresoViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/ecohand/presentation/progreso/ProgresoViewModel.kt" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="package com.example.ecohand.presentation.progreso&#10;&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.ecohand.data.local.entity.LogroEntity&#10;import com.example.ecohand.data.repository.ProgresoRepository&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.launch&#10;import java.util.Calendar&#10;&#10;data class ProgresoUiState(&#10;    val isLoading: Boolean = true,&#10;    val leccionesCompletadas: Int = 0,&#10;    val totalLecciones: Int = 5,&#10;    val porcentajeProgreso: Float = 0f,&#10;    val puntosTotal: Int = 0,&#10;    val rachaActual: Int = 0,&#10;    val leccionesCount: Int = 0,&#10;    val diasActivos: Int = 0,&#10;    val actividadSemanal: List&lt;DiaActividad&gt; = emptyList(),&#10;    val logros: List&lt;LogroConEstado&gt; = emptyList(),&#10;    val errorMessage: String? = null&#10;)&#10;&#10;data class DiaActividad(&#10;    val dia: String, // L, M, X, J, V, S, D&#10;    val activo: Boolean,&#10;    val fecha: Long&#10;)&#10;&#10;data class LogroConEstado(&#10;    val logro: LogroEntity,&#10;    val obtenido: Boolean,&#10;    val fechaObtenido: Long?&#10;)&#10;&#10;class ProgresoViewModel(&#10;    private val progresoRepository: ProgresoRepository,&#10;    private val usuarioId: Int&#10;) : ViewModel() {&#10;&#10;    private val _uiState = MutableStateFlow(ProgresoUiState())&#10;    val uiState: StateFlow&lt;ProgresoUiState&gt; = _uiState.asStateFlow()&#10;&#10;    init {&#10;        cargarProgreso()&#10;    }&#10;&#10;    fun cargarProgreso() {&#10;        viewModelScope.launch {&#10;            try {&#10;                _uiState.value = _uiState.value.copy(isLoading = true, errorMessage = null)&#10;&#10;                // Registrar actividad del día&#10;                progresoRepository.registrarActividadDiaria(usuarioId)&#10;&#10;                // Obtener estadísticas&#10;                val estadisticas = progresoRepository.getOrCreateEstadisticas(usuarioId)&#10;&#10;                // Obtener lecciones&#10;                val totalLecciones = progresoRepository.getTotalLecciones()&#10;                val leccionesCompletadas = progresoRepository.getLeccionesCompletadas(usuarioId)&#10;                val porcentaje = if (totalLecciones &gt; 0) {&#10;                    (leccionesCompletadas.toFloat() / totalLecciones.toFloat())&#10;                } else 0f&#10;&#10;                // Obtener actividad semanal&#10;                val actividadSemanal = obtenerActividadSemanal()&#10;&#10;                // Obtener logros&#10;                val logrosData = progresoRepository.getLogrosUsuario(usuarioId)&#10;                val logros = logrosData.map { (logro, logroUsuario) -&gt;&#10;                    LogroConEstado(&#10;                        logro = logro,&#10;                        obtenido = logroUsuario.obtenido,&#10;                        fechaObtenido = logroUsuario.fechaObtenido&#10;                    )&#10;                }&#10;&#10;                // Verificar logros&#10;                progresoRepository.verificarLogros(usuarioId)&#10;&#10;                _uiState.value = ProgresoUiState(&#10;                    isLoading = false,&#10;                    leccionesCompletadas = leccionesCompletadas,&#10;                    totalLecciones = totalLecciones,&#10;                    porcentajeProgreso = porcentaje,&#10;                    puntosTotal = estadisticas.puntosTotal,&#10;                    rachaActual = estadisticas.rachaActual,&#10;                    leccionesCount = leccionesCompletadas,&#10;                    diasActivos = estadisticas.diasActivos,&#10;                    actividadSemanal = actividadSemanal,&#10;                    logros = logros&#10;                )&#10;            } catch (e: Exception) {&#10;                _uiState.value = _uiState.value.copy(&#10;                    isLoading = false,&#10;                    errorMessage = &quot;Error al cargar el progreso: ${e.message}&quot;&#10;                )&#10;            }&#10;        }&#10;    }&#10;&#10;    private suspend fun obtenerActividadSemanal(): List&lt;DiaActividad&gt; {&#10;        val actividades = progresoRepository.getActividadSemanal(usuarioId)&#10;        val calendar = Calendar.getInstance()&#10;&#10;        // Obtener el inicio de la semana (Lunes)&#10;        calendar.set(Calendar.DAY_OF_WEEK, Calendar.MONDAY)&#10;        calendar.set(Calendar.HOUR_OF_DAY, 0)&#10;        calendar.set(Calendar.MINUTE, 0)&#10;        calendar.set(Calendar.SECOND, 0)&#10;        calendar.set(Calendar.MILLISECOND, 0)&#10;&#10;        val diasSemana = listOf(&quot;L&quot;, &quot;M&quot;, &quot;X&quot;, &quot;J&quot;, &quot;V&quot;, &quot;S&quot;, &quot;D&quot;)&#10;        val resultado = mutableListOf&lt;DiaActividad&gt;()&#10;&#10;        for (i in 0..6) {&#10;            val fecha = calendar.timeInMillis&#10;            val activo = actividades.any { it.fecha == fecha &amp;&amp; it.activo }&#10;&#10;            resultado.add(&#10;                DiaActividad(&#10;                    dia = diasSemana[i],&#10;                    activo = activo,&#10;                    fecha = fecha&#10;                )&#10;            )&#10;&#10;            calendar.add(Calendar.DAY_OF_YEAR, 1)&#10;        }&#10;&#10;        return resultado&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>